
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Alexander Hagerman">
      
      
        <link rel="canonical" href="https://burningdaylight.io/blog/2018/12/22/docker-airflow/">
      
      
        <link rel="prev" href="../../../10/27/dealing-with-null-in-pyspark-transformations/">
      
      
        <link rel="next" href="../../../../2019/01/02/building-vim-with-anaconda-python-support/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../../../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../../../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../../../../icons/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>docker-airflow - burningdaylight</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../css/styles.css">
    
      <link rel="stylesheet" href="../../../../../css/portfolio.css">
    
      <link rel="stylesheet" href="../../../../../css/resume.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="hsl(195,-80%,-42%)" data-md-color-accent="hsl(284,-22%,-36%)">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#what-is-apache-airflow" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://burningdaylight.io" title="burningdaylight" class="md-header__button md-logo" aria-label="burningdaylight" data-md-component="logo">
      
  <img src="../../../../../icons/favicon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            burningdaylight
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              docker-airflow
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="hsl(195,-80%,-42%)" data-md-color-accent="hsl(284,-22%,-36%)"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="hsl(284,-22%,-36%)" data-md-color-accent="hsl(195,-80%,-42%)"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://burningdaylight.io" title="burningdaylight" class="md-nav__button md-logo" aria-label="burningdaylight" data-md-component="logo">
      
  <img src="../../../../../icons/favicon.png" alt="logo">

    </a>
    burningdaylight
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../me/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Me
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      <a href="../../../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archive
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2025/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2025
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2022/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2021/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2021
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2020/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2020
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2019/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2019
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2018/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2018
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Lists
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Lists
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../lists/books/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Books
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../lists/podcast/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Podcast
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Programming
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Programming
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../programming/portfolio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Portfolio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../programming/resume/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resume
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-apache-airflow" class="md-nav__link">
    <span class="md-ellipsis">
      What is Apache Airflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-airflow" class="md-nav__link">
    <span class="md-ellipsis">
      Why Airflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-conda" class="md-nav__link">
    <span class="md-ellipsis">
      Why conda
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-airflow" class="md-nav__link">
    <span class="md-ellipsis">
      docker-airflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customizing-the-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Customizing the setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#issues-so-far" class="md-nav__link">
    <span class="md-ellipsis">
      Issues so far
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reaching-out" class="md-nav__link">
    <span class="md-ellipsis">
      Reaching out
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2018-12-22 00:00:00+00:00" class="md-ellipsis">December 22, 2018</time>
                      </div>
                    </li>
                    
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              7 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        


  <h1>docker-airflow</h1>

<p>If you’ve spent time using Python for ETL processes or working with data pipelines using tools from the Apache ecosystem
then you’ve probably heard about <a href="https://airflow.apache.org/">Apache Airflow</a>. In this post I’m going to briefly write
about why I’m using Airflow, show how you can get started with Airflow using docker and I will show how I customized
this setup so that you can do the same. Finally at the end I’ll talk about a couple of issues I ran into getting started
with Airflow and docker.</p>
<h3 id="what-is-apache-airflow">What is Apache Airflow<a class="headerlink" href="#what-is-apache-airflow" title="Permanent link">&para;</a></h3>
<p>From the <a href="https://airflow.apache.org/">home page</a>:</p>
<ul>
<li>Airflow is a platform to programmatically author, schedule and monitor workflows.
  <strong>Programatically</strong> being a key part so that you can create and orchestrate worflows/data pipelines using the same
  processes and tools that let you create reliable, scaling software.</li>
</ul>
<h3 id="why-airflow">Why Airflow<a class="headerlink" href="#why-airflow" title="Permanent link">&para;</a></h3>
<p>I don’t plan to write much on this subject since it’s been covered in depth else where, but at work and often times when
talking about Airflow the question of why Airflow versus X traditional solution where X is something like:</p>
<p>inevitably comes up. The primary reason I prefer a solution like Airflow to more traditional solutions is because my ETL
is code. While there are numerous benefits to ETL as code my talking points are:</p>
<ul>
<li>Your data pipes/workflows go through the same processes that helps you create better products like TDD</li>
<li>Your ETL development and production can be integrated with your CI/CD process</li>
<li>Better debugging tools</li>
<li>Flexibility</li>
</ul>
<p>That’s not to say the traditional tools don’t have their place, but my experience is that any significantly complex data
pipeline ends up making use of that tools script task (C# for SSIS, Java for Informatica) and now you have an
amalgamation of GUI product and untested, undocumented and non versioned code in production data pipelines.</p>
<h3 id="why-conda">Why conda<a class="headerlink" href="#why-conda" title="Permanent link">&para;</a></h3>
<p>By day I’m a data engineer helping to build platforms, applications and pipelines to enable data scientist. Because of
this conda is a tool I’ve become familiar with and it let’s me work across languages, but easily integrate those various
languages into my Airflow dags.</p>
<p>To get started with Airflow I highly recommend reading <a href="https://airflow.apache.org/index.html">the homepage</a>
and <a href="https://airflow.apache.org/tutorial.html">tutorial</a> to get an idea of the core concepts and pick up on the
vocabulary used within the framework.</p>
<p>After that there is a great project called <a href="https://github.com/puckel/docker-airflow">docker-airflow</a> that you can get
started with. This provides a quick way to get started with Airflow in an environment with sane defaults making use of
Postgres and Redis.</p>
<p>This project provides an example dag and also allows you to load the Airflow example dags via the LOADEX environment
variable. Additionally you might want to open up the Airflow dashboard and checkout the Connections tab where you can
setup things such as SSH an SSH connection to reference in your dags.</p>
<h3 id="docker-airflow"><a href="https://github.com/puckel/docker-airflow">docker-airflow</a><a class="headerlink" href="#docker-airflow" title="Permanent link">&para;</a></h3>
<p>To get started with Airflow I highly recommend reading <a href="https://airflow.apache.org/index.html">the homepage</a>
and <a href="https://airflow.apache.org/tutorial.html">tutorial</a> to get an idea of the core concepts and pick up on the
vocabulary used within the framework.</p>
<p>After that there is a great project called <a href="https://github.com/puckel/docker-airflow">docker-airflow</a> that you can get
started with. This provides a quick way to get started with Airflow in an environment with sane defaults making use of
Postgres and Redis.</p>
<p>This project provides an example dag and also allows you to load the Airflow example dags via the LOADEXenvironment
variable. Additionally you might want to open up the Airflow dashboard and checkout the Connections tab where you can
setup things such as SSH an SSH connection to reference in your dags.</p>
<h3 id="customizing-the-setup">Customizing the setup<a class="headerlink" href="#customizing-the-setup" title="Permanent link">&para;</a></h3>
<p>The <a href="https://github.com/puckel/docker-airflow">docker-airflow</a> project is a great start, but it makes assumptions that
may not be true of your environment such as which database you plan to use, use of environment variables, etc.</p>
<p>If all you’re needing to tweak is the behavior of the environment or Airflow your first stop should be airflow.cfg in
the /config directory. This is a centralized location for Airflow settings and is checked after any settings from the
environment are loaded. If you're trying to change settings related to work pools, ssl, kerberos, etc this is probably
the best place to get started.</p>
<p>If you’re looking to change things related to your containers such as when to restart, dependencies, etc then your going
to want to checkout either the LocalExecutor or CeleryExecutor docker-compose files.</p>
<p>Finally you might want to make bigger changes like I did such as using a different database, base docker image etc.
Doing this requires changing quite a few items. The changes I made were:</p>
<ul>
<li>switch to miniconda for my base image to use Intel Dist Python</li>
<li>switch to Microsoft SQL Server for the database</li>
<li>switch the task queue to RabbitMQ</li>
</ul>
<p>Most of this was driven by a desire to experiment and to learn more about tools that I use day to day. Since I work in a
data engineering shop there are packages from conda-forge that I like to use driving the miniconda switch, I've used MS
SQL for the last 8 years professionally and I've been working on scaling with RabbitMQ over the last year.</p>
<p>The switch to miniconda was a one liner in the Dockfile:</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">continuumio/miniconda3Then</span><span class="w"> </span>to<span class="w"> </span>use<span class="w"> </span>IDP<span class="w"> </span><span class="o">(</span>Intel<span class="w"> </span>Distribution<span class="w"> </span>of<span class="w"> </span>Python<span class="o">)</span><span class="w"> </span>within<span class="w"> </span>the<span class="w"> </span>container<span class="w"> </span>I<span class="w"> </span>added<span class="w"> </span>this<span class="w"> </span>towards<span class="w"> </span>the<span class="w"> </span>bottom:

<span class="k">RUN</span><span class="w"> </span>conda<span class="w"> </span>config<span class="w"> </span>--add<span class="w"> </span>channels<span class="w"> </span>intel<span class="se">\ </span><span class="w"> </span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>conda<span class="w"> </span>config<span class="w"> </span>--add<span class="w"> </span>channels<span class="w"> </span>conda-forge<span class="w"> </span><span class="se">\ </span><span class="w"> </span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>conda<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>-q<span class="w"> </span><span class="nv">intelpython3core</span><span class="o">=</span><span class="m">2019</span>.1<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="se">\ </span><span class="w"> </span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>conda<span class="w"> </span>clean<span class="w"> </span>--all<span class="w"> </span><span class="se">\A</span>nd<span class="w"> </span>with<span class="w"> </span>that<span class="w"> </span>I<span class="w"> </span>can<span class="w"> </span>make<span class="w"> </span>use<span class="w"> </span>of<span class="w"> </span>conda<span class="w"> </span>packages<span class="w"> </span>alongside<span class="w"> </span>traditional<span class="w"> </span>Python<span class="w"> </span>packages<span class="w"> </span>within<span class="w"> </span>my<span class="w"> </span>Airflow<span class="w"> </span>environment.
</code></pre></div>
<p>Next up I wanted to switch to MSSQL. Doing this was a matter of switching from Postgres in docker-compose and adding the
MSSQL Linux drivers to the base docker-airflow Dockerfile.</p>
<p><strong>docker-compose</strong></p>
<div class="highlight"><pre><span></span><code><span class="nt">mssql</span><span class="p">:</span><span class="w">  </span>
<span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">microsoft/mssql-server-linux:latest</span><span class="w">  </span>
<span class="w"> </span><span class="nt">environment</span><span class="p">:</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ACCEPTEULA=Y</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SAPASSWORD=YourStrong!Passw0rd</span><span class="w">  </span>
<span class="w"> </span><span class="nt">ports</span><span class="p">:</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1433:1433</span><span class="w">  </span>
<span class="w"> </span><span class="nt">volumes</span><span class="p">:</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/opt/mssqlYou may or may not want to preserver your database volume so keep that in mind.</span>
</code></pre></div>
<p>Setting up the MSSQL Linux drivers is fairly straight forward following
the <a href="https://docs.microsoft.com/en-us/sql/connect/odbc/linux-mac/installing-the-microsoft-odbc-driver-for-sql-server?view=sql-server-2017">documentation</a>
from Microsoft.</p>
<p><strong>Dockerfile</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">ENV</span><span class="w"> </span><span class="nv">ACCEPTEULA</span><span class="o">=</span>Y
<span class="k">RUN</span><span class="w"> </span>curl<span class="w"> </span>https://packages.microsoft.com/keys/microsoft.asc<span class="w"> </span><span class="p">|</span><span class="w"> </span>apt-key<span class="w"> </span>add<span class="w"> </span>-<span class="w"> </span><span class="se">\ </span><span class="w"> </span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>curl<span class="w"> </span>https://packages.microsoft.com/config/ubuntu/16.04/prod.list<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/msprod.listRUN<span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span>-yqq<span class="w"> </span><span class="se">\ </span><span class="w"> </span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-yqq<span class="w"> </span>mssql-tools<span class="w"> </span>unixodbc-dev
</code></pre></div>
<p>One thing to note if you’re using a Debian based image is that Microsoft has a somewhat obscure dependency on
libssl1.0.0. Without that installed you will get some obscure unixodbc error connecting to MSSQL with sql-alchemy. To
remedy this add the below to your Dockerfile.</p>
<div class="highlight"><pre><span></span><code><span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export PATH=&quot;$PATH:/opt/mssql-tools/bin&quot;&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashprofile<span class="w">  </span>
<span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb http://httpredir.debian.org/debian jessie main contrib non-free\</span>
<span class="s2"> deb-src http://httpredir.debian.org/debian jessie main contrib non-free\n</span>
<span class="w"> </span>deb<span class="w"> </span>http://security.debian.org/<span class="w"> </span>jessie/updates<span class="w"> </span>main<span class="w"> </span>contrib<span class="w"> </span>non-free<span class="se">\</span>
<span class="w"> </span>deb-src<span class="w"> </span>http://security.debian.org/<span class="w"> </span>jessie/updates<span class="w"> </span>main<span class="w"> </span>contrib<span class="w"> </span>non-free<span class="s2">&quot; &gt;&gt; /etc/apt/sources.list.d/jessie.listRUN apt update \  </span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>libssl1.0.0
</code></pre></div>
<p>Finally setup your connection string either in airflow.cfg or an
Airflow <a href="https://airflow.readthedocs.io/en/stable/howto/set-config.html">environment variable</a> . I like to use the
Airflow environment variables and pass them in from a .env file with docker-compose.</p>
<div class="highlight"><pre><span></span><code><span class="nt">environment</span><span class="p">:</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LOADEX=n</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FERNETKEY=46BKJoQYlPPOexq0OhDZnIlNepKFf87WFwLbfzqDDho=</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EXECUTOR=Celery</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AIRFLOWCELERYBROKERURL=${CELERYRABBITBROKER}</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AIRFLOWCORESQLALCHEMYCONN=${SQLALCHEMYCONN}</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AIRFLOWCELERYRESULTBACKEND=${CELERYRESULTSBACKEND}And finally the last big change I implemented was the switch to RabbitMQ instead of Redis. Similar to the MSSQL switch this was just an update to the docker-compose file.</span>

<span class="nt">rabbitmq</span><span class="p">:</span><span class="w">  </span>
<span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rabbitmq:3-management</span><span class="w">  </span>
<span class="w"> </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rabbitmq</span><span class="w">  </span>
<span class="w"> </span><span class="nt">environment</span><span class="p">:</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RABBITMQERLANGCOOKIE=${RABBITMQERLANGCOOKIE}</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RABBITMQDEFAULTUSER=${RABBITMQDEFAULTUSER}</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RABBITMQDEFAULTPASS=${RABBITMQDEFAULTPASS}</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RABBITMQDEFAULTVHOST=${RABBITMQDEFAULTVHOST}</span>
</code></pre></div>
<p>And setting up the right connection string for Celery to talk with rabbitmq. Similar to the MSSQL connection string I
put this in my .env file and reference it in my docker-compose file as seen above.</p>
<div class="highlight"><pre><span></span><code><span class="nv">CELERYRABBITBROKER</span><span class="o">=</span>amqp://user:pass@host:port/
</code></pre></div>
<p>One thing to note is anytime you are referencing the host and running with docker-compose you can reference the service
id in this case rabbitmq as the host name.
And with that I have a nice Airflow environment that lets me make use of the database I’m familiar with, a durable queue
and packages across the Python and Data Science ecosystems via conda.</p>
<p>You can find these changes in my fork of the <a href="https://github.com/n0mn0m/airflow-docker">docker-airflow</a> project. I’ve
also opened a <a href="https://github.com/puckel/docker-airflow/issues/289">GitHub issue</a> with the goal of creating some way to
track other community variations of docker-airflow with the hope of helping others discover setups specific to their
need.</p>
<h3 id="issues-so-far">Issues so far<a class="headerlink" href="#issues-so-far" title="Permanent link">&para;</a></h3>
<p>I’ve been using the setup above for a couple weeks now with pretty good results. I’ve made use of some libraries like
hdfs3 that have their latest releases in conda-forge and my familiarity with MSSQL has saved me some maintenance time.
The experience hasn’t been without it’s issues. The highlights are:</p>
<ul>
<li><a href="https://airflow.apache.org/installation.html#extra-packages">Airflow packages</a> may not be what you want. See
  librabbitmq and celery. It's best to manage a requirements.txt or conda.txt with your dependencies still.</li>
<li>Dependency management across multiple dags. In short with a standard setup you need one package version and it needs
  to be installed everywhere. For an interesting approach to this
  read <a href="https://medium.com/bluecore-engineering/were-all-using-airflow-wrong-and-how-to-fix-it-a56f14cb0753">We’re All Using Airflow Wrong and How to Fix It</a></li>
<li>Silent failures. Be aware of all the reasons why a worker may provide exit code 0 especially with docker. This took a
  minute to catch when an NFS mount stopped showing new files being available, but the exit code 0 made things seem ok.
  This isn’t Airflows fault, but just something to keep in mind when using Airflow in an environment with docker and
  remote resources.</li>
</ul>
<h3 id="reaching-out">Reaching out<a class="headerlink" href="#reaching-out" title="Permanent link">&para;</a></h3>
<p>Hopefully this post helps you get started with <a href="https://github.com/puckel/docker-airflow">docker-airflow</a>. If you have
questions or want to share something cool that you end up doing feel free to open up
an <a href="https://todo.sr.ht/%7En0mn0m/Airflow-Bugs">issue</a> on Sourcehut or reach out to
me <a href="mailto:n0mn0m@burningdaylight.io">n0mn0m@burningdaylight.io</a>.</p>







  
  




  



      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="/feed_rss_updated.xml" target="_blank" rel="noopener" title="RSS Feed" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 64c0-17.7 14.3-32 32-32 229.8 0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7 0 64m0 352a64 64 0 1 1 128 0 64 64 0 1 1-128 0m32-256c159.1 0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7 0-32-14.3-32-32s14.3-32 32-32"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.path", "icons"], "search": "../../../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
        <script src="../../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
      
    
  </body>
</html>