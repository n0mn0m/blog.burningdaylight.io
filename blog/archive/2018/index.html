
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Alexander Hagerman">
      
      
        <link rel="canonical" href="https://burningdaylight.io/blog/archive/2018/">
      
      
        <link rel="prev" href="../2019/">
      
      
        <link rel="next" href="../../../lists/books/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../../icons/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>2018 - burningdaylight</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/styles.css">
    
      <link rel="stylesheet" href="../../../css/portfolio.css">
    
      <link rel="stylesheet" href="../../../css/resume.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="hsl(195,-80%,-42%)" data-md-color-accent="hsl(284,-22%,-36%)">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2018" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://burningdaylight.io" title="burningdaylight" class="md-header__button md-logo" aria-label="burningdaylight" data-md-component="logo">
      
  <img src="../../../icons/favicon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            burningdaylight
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2018
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="hsl(195,-80%,-42%)" data-md-color-accent="hsl(284,-22%,-36%)"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="hsl(284,-22%,-36%)" data-md-color-accent="hsl(195,-80%,-42%)"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://burningdaylight.io" title="burningdaylight" class="md-nav__button md-logo" aria-label="burningdaylight" data-md-component="logo">
      
  <img src="../../../icons/favicon.png" alt="logo">

    </a>
    burningdaylight
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../me/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Me
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archive
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2025/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2025
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2022/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2021/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2021
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2020/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2020
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2019/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2019
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    
      
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    2018
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    2018
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#docker-airflow" class="md-nav__link">
    <span class="md-ellipsis">
      docker-airflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dealing-with-null-in-pyspark-transformations" class="md-nav__link">
    <span class="md-ellipsis">
      Dealing with NULL in PySpark transformations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#derbypy-intro-to-pyspark" class="md-nav__link">
    <span class="md-ellipsis">
      DerbyPy Intro to PySpark
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#derbypy-introduction-to-python-modules-and-packages" class="md-nav__link">
    <span class="md-ellipsis">
      DerbyPy Introduction to Python Modules and Packages
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recursive-search-with-python" class="md-nav__link">
    <span class="md-ellipsis">
      Recursive Search with Python
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#publishing-with-pelican-on-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Publishing with Pelican on Windows
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Started
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Lists
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Lists
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lists/books/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Books
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lists/podcast/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Podcast
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Programming
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Programming
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/portfolio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Portfolio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/resume/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resume
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#docker-airflow" class="md-nav__link">
    <span class="md-ellipsis">
      docker-airflow
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dealing-with-null-in-pyspark-transformations" class="md-nav__link">
    <span class="md-ellipsis">
      Dealing with NULL in PySpark transformations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#derbypy-intro-to-pyspark" class="md-nav__link">
    <span class="md-ellipsis">
      DerbyPy Intro to PySpark
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#derbypy-introduction-to-python-modules-and-packages" class="md-nav__link">
    <span class="md-ellipsis">
      DerbyPy Introduction to Python Modules and Packages
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recursive-search-with-python" class="md-nav__link">
    <span class="md-ellipsis">
      Recursive Search with Python
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#publishing-with-pelican-on-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Publishing with Pelican on Windows
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Started
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="2018">2018<a class="headerlink" href="#2018" title="Permanent link">&para;</a></h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2018-12-22 00:00:00+00:00">December 22, 2018</time></li>
        
        
          
          <li class="md-meta__item">
            
              7 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="docker-airflow"><a class="toclink" href="../../2018/12/22/docker-airflow/">docker-airflow</a></h2>
<p>If you’ve spent time using Python for ETL processes or working with data pipelines using tools from the Apache ecosystem
then you’ve probably heard about <a href="https://airflow.apache.org/">Apache Airflow</a>. In this post I’m going to briefly write
about why I’m using Airflow, show how you can get started with Airflow using docker and I will show how I customized
this setup so that you can do the same. Finally at the end I’ll talk about a couple of issues I ran into getting started
with Airflow and docker.</p>
<h4 id="what-is-apache-airflow"><a class="toclink" href="../../2018/12/22/docker-airflow/#what-is-apache-airflow">What is Apache Airflow</a></h4>
<p>From the <a href="https://airflow.apache.org/">home page</a>:</p>
<ul>
<li>Airflow is a platform to programmatically author, schedule and monitor workflows.
  <strong>Programatically</strong> being a key part so that you can create and orchestrate worflows/data pipelines using the same
  processes and tools that let you create reliable, scaling software.</li>
</ul>
<h4 id="why-airflow"><a class="toclink" href="../../2018/12/22/docker-airflow/#why-airflow">Why Airflow</a></h4>
<p>I don’t plan to write much on this subject since it’s been covered in depth else where, but at work and often times when
talking about Airflow the question of why Airflow versus X traditional solution where X is something like:</p>
<p>inevitably comes up. The primary reason I prefer a solution like Airflow to more traditional solutions is because my ETL
is code. While there are numerous benefits to ETL as code my talking points are:</p>
<ul>
<li>Your data pipes/workflows go through the same processes that helps you create better products like TDD</li>
<li>Your ETL development and production can be integrated with your CI/CD process</li>
<li>Better debugging tools</li>
<li>Flexibility</li>
</ul>
<p>That’s not to say the traditional tools don’t have their place, but my experience is that any significantly complex data
pipeline ends up making use of that tools script task (C# for SSIS, Java for Informatica) and now you have an
amalgamation of GUI product and untested, undocumented and non versioned code in production data pipelines.</p>
<h4 id="why-conda"><a class="toclink" href="../../2018/12/22/docker-airflow/#why-conda">Why conda</a></h4>
<p>By day I’m a data engineer helping to build platforms, applications and pipelines to enable data scientist. Because of
this conda is a tool I’ve become familiar with and it let’s me work across languages, but easily integrate those various
languages into my Airflow dags.</p>
<p>To get started with Airflow I highly recommend reading <a href="https://airflow.apache.org/index.html">the homepage</a>
and <a href="https://airflow.apache.org/tutorial.html">tutorial</a> to get an idea of the core concepts and pick up on the
vocabulary used within the framework.</p>
<p>After that there is a great project called <a href="https://github.com/puckel/docker-airflow">docker-airflow</a> that you can get
started with. This provides a quick way to get started with Airflow in an environment with sane defaults making use of
Postgres and Redis.</p>
<p>This project provides an example dag and also allows you to load the Airflow example dags via the LOADEX environment
variable. Additionally you might want to open up the Airflow dashboard and checkout the Connections tab where you can
setup things such as SSH an SSH connection to reference in your dags.</p>
<h4 id="docker-airflow_1"><a class="toclink" href="../../2018/12/22/docker-airflow/#docker-airflow_1"><a href="https://github.com/puckel/docker-airflow">docker-airflow</a></a></h4>
<p>To get started with Airflow I highly recommend reading <a href="https://airflow.apache.org/index.html">the homepage</a>
and <a href="https://airflow.apache.org/tutorial.html">tutorial</a> to get an idea of the core concepts and pick up on the
vocabulary used within the framework.</p>
<p>After that there is a great project called <a href="https://github.com/puckel/docker-airflow">docker-airflow</a> that you can get
started with. This provides a quick way to get started with Airflow in an environment with sane defaults making use of
Postgres and Redis.</p>
<p>This project provides an example dag and also allows you to load the Airflow example dags via the LOADEXenvironment
variable. Additionally you might want to open up the Airflow dashboard and checkout the Connections tab where you can
setup things such as SSH an SSH connection to reference in your dags.</p>
<h4 id="customizing-the-setup"><a class="toclink" href="../../2018/12/22/docker-airflow/#customizing-the-setup">Customizing the setup</a></h4>
<p>The <a href="https://github.com/puckel/docker-airflow">docker-airflow</a> project is a great start, but it makes assumptions that
may not be true of your environment such as which database you plan to use, use of environment variables, etc.</p>
<p>If all you’re needing to tweak is the behavior of the environment or Airflow your first stop should be airflow.cfg in
the /config directory. This is a centralized location for Airflow settings and is checked after any settings from the
environment are loaded. If you're trying to change settings related to work pools, ssl, kerberos, etc this is probably
the best place to get started.</p>
<p>If you’re looking to change things related to your containers such as when to restart, dependencies, etc then your going
to want to checkout either the LocalExecutor or CeleryExecutor docker-compose files.</p>
<p>Finally you might want to make bigger changes like I did such as using a different database, base docker image etc.
Doing this requires changing quite a few items. The changes I made were:</p>
<ul>
<li>switch to miniconda for my base image to use Intel Dist Python</li>
<li>switch to Microsoft SQL Server for the database</li>
<li>switch the task queue to RabbitMQ</li>
</ul>
<p>Most of this was driven by a desire to experiment and to learn more about tools that I use day to day. Since I work in a
data engineering shop there are packages from conda-forge that I like to use driving the miniconda switch, I've used MS
SQL for the last 8 years professionally and I've been working on scaling with RabbitMQ over the last year.</p>
<p>The switch to miniconda was a one liner in the Dockfile:</p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">continuumio/miniconda3Then</span><span class="w"> </span>to<span class="w"> </span>use<span class="w"> </span>IDP<span class="w"> </span><span class="o">(</span>Intel<span class="w"> </span>Distribution<span class="w"> </span>of<span class="w"> </span>Python<span class="o">)</span><span class="w"> </span>within<span class="w"> </span>the<span class="w"> </span>container<span class="w"> </span>I<span class="w"> </span>added<span class="w"> </span>this<span class="w"> </span>towards<span class="w"> </span>the<span class="w"> </span>bottom:

<span class="k">RUN</span><span class="w"> </span>conda<span class="w"> </span>config<span class="w"> </span>--add<span class="w"> </span>channels<span class="w"> </span>intel<span class="se">\ </span><span class="w"> </span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>conda<span class="w"> </span>config<span class="w"> </span>--add<span class="w"> </span>channels<span class="w"> </span>conda-forge<span class="w"> </span><span class="se">\ </span><span class="w"> </span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>conda<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>-q<span class="w"> </span><span class="nv">intelpython3core</span><span class="o">=</span><span class="m">2019</span>.1<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="se">\ </span><span class="w"> </span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>conda<span class="w"> </span>clean<span class="w"> </span>--all<span class="w"> </span><span class="se">\A</span>nd<span class="w"> </span>with<span class="w"> </span>that<span class="w"> </span>I<span class="w"> </span>can<span class="w"> </span>make<span class="w"> </span>use<span class="w"> </span>of<span class="w"> </span>conda<span class="w"> </span>packages<span class="w"> </span>alongside<span class="w"> </span>traditional<span class="w"> </span>Python<span class="w"> </span>packages<span class="w"> </span>within<span class="w"> </span>my<span class="w"> </span>Airflow<span class="w"> </span>environment.
</code></pre></div>
<p>Next up I wanted to switch to MSSQL. Doing this was a matter of switching from Postgres in docker-compose and adding the
MSSQL Linux drivers to the base docker-airflow Dockerfile.</p>
<p><strong>docker-compose</strong></p>
<div class="highlight"><pre><span></span><code><span class="nt">mssql</span><span class="p">:</span><span class="w">  </span>
<span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">microsoft/mssql-server-linux:latest</span><span class="w">  </span>
<span class="w"> </span><span class="nt">environment</span><span class="p">:</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ACCEPTEULA=Y</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SAPASSWORD=YourStrong!Passw0rd</span><span class="w">  </span>
<span class="w"> </span><span class="nt">ports</span><span class="p">:</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1433:1433</span><span class="w">  </span>
<span class="w"> </span><span class="nt">volumes</span><span class="p">:</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/opt/mssqlYou may or may not want to preserver your database volume so keep that in mind.</span>
</code></pre></div>
<p>Setting up the MSSQL Linux drivers is fairly straight forward following
the <a href="https://docs.microsoft.com/en-us/sql/connect/odbc/linux-mac/installing-the-microsoft-odbc-driver-for-sql-server?view=sql-server-2017">documentation</a>
from Microsoft.</p>
<p><strong>Dockerfile</strong></p>
<div class="highlight"><pre><span></span><code><span class="k">ENV</span><span class="w"> </span><span class="nv">ACCEPTEULA</span><span class="o">=</span>Y
<span class="k">RUN</span><span class="w"> </span>curl<span class="w"> </span>https://packages.microsoft.com/keys/microsoft.asc<span class="w"> </span><span class="p">|</span><span class="w"> </span>apt-key<span class="w"> </span>add<span class="w"> </span>-<span class="w"> </span><span class="se">\ </span><span class="w"> </span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>curl<span class="w"> </span>https://packages.microsoft.com/config/ubuntu/16.04/prod.list<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/msprod.listRUN<span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span>-yqq<span class="w"> </span><span class="se">\ </span><span class="w"> </span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-yqq<span class="w"> </span>mssql-tools<span class="w"> </span>unixodbc-dev
</code></pre></div>
<p>One thing to note if you’re using a Debian based image is that Microsoft has a somewhat obscure dependency on
libssl1.0.0. Without that installed you will get some obscure unixodbc error connecting to MSSQL with sql-alchemy. To
remedy this add the below to your Dockerfile.</p>
<div class="highlight"><pre><span></span><code><span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export PATH=&quot;$PATH:/opt/mssql-tools/bin&quot;&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashprofile<span class="w">  </span>
<span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb http://httpredir.debian.org/debian jessie main contrib non-free\</span>
<span class="s2"> deb-src http://httpredir.debian.org/debian jessie main contrib non-free\n</span>
<span class="w"> </span>deb<span class="w"> </span>http://security.debian.org/<span class="w"> </span>jessie/updates<span class="w"> </span>main<span class="w"> </span>contrib<span class="w"> </span>non-free<span class="se">\</span>
<span class="w"> </span>deb-src<span class="w"> </span>http://security.debian.org/<span class="w"> </span>jessie/updates<span class="w"> </span>main<span class="w"> </span>contrib<span class="w"> </span>non-free<span class="s2">&quot; &gt;&gt; /etc/apt/sources.list.d/jessie.listRUN apt update \  </span>
<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>libssl1.0.0
</code></pre></div>
<p>Finally setup your connection string either in airflow.cfg or an
Airflow <a href="https://airflow.readthedocs.io/en/stable/howto/set-config.html">environment variable</a> . I like to use the
Airflow environment variables and pass them in from a .env file with docker-compose.</p>
<div class="highlight"><pre><span></span><code><span class="nt">environment</span><span class="p">:</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LOADEX=n</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FERNETKEY=46BKJoQYlPPOexq0OhDZnIlNepKFf87WFwLbfzqDDho=</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">EXECUTOR=Celery</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AIRFLOWCELERYBROKERURL=${CELERYRABBITBROKER}</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AIRFLOWCORESQLALCHEMYCONN=${SQLALCHEMYCONN}</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AIRFLOWCELERYRESULTBACKEND=${CELERYRESULTSBACKEND}And finally the last big change I implemented was the switch to RabbitMQ instead of Redis. Similar to the MSSQL switch this was just an update to the docker-compose file.</span>

<span class="nt">rabbitmq</span><span class="p">:</span><span class="w">  </span>
<span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rabbitmq:3-management</span><span class="w">  </span>
<span class="w"> </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rabbitmq</span><span class="w">  </span>
<span class="w"> </span><span class="nt">environment</span><span class="p">:</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RABBITMQERLANGCOOKIE=${RABBITMQERLANGCOOKIE}</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RABBITMQDEFAULTUSER=${RABBITMQDEFAULTUSER}</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RABBITMQDEFAULTPASS=${RABBITMQDEFAULTPASS}</span><span class="w">  </span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RABBITMQDEFAULTVHOST=${RABBITMQDEFAULTVHOST}</span>
</code></pre></div>
<p>And setting up the right connection string for Celery to talk with rabbitmq. Similar to the MSSQL connection string I
put this in my .env file and reference it in my docker-compose file as seen above.</p>
<div class="highlight"><pre><span></span><code><span class="nv">CELERYRABBITBROKER</span><span class="o">=</span>amqp://user:pass@host:port/
</code></pre></div>
<p>One thing to note is anytime you are referencing the host and running with docker-compose you can reference the service
id in this case rabbitmq as the host name.
And with that I have a nice Airflow environment that lets me make use of the database I’m familiar with, a durable queue
and packages across the Python and Data Science ecosystems via conda.</p>
<p>You can find these changes in my fork of the <a href="https://github.com/n0mn0m/airflow-docker">docker-airflow</a> project. I’ve
also opened a <a href="https://github.com/puckel/docker-airflow/issues/289">GitHub issue</a> with the goal of creating some way to
track other community variations of docker-airflow with the hope of helping others discover setups specific to their
need.</p>
<h4 id="issues-so-far"><a class="toclink" href="../../2018/12/22/docker-airflow/#issues-so-far">Issues so far</a></h4>
<p>I’ve been using the setup above for a couple weeks now with pretty good results. I’ve made use of some libraries like
hdfs3 that have their latest releases in conda-forge and my familiarity with MSSQL has saved me some maintenance time.
The experience hasn’t been without it’s issues. The highlights are:</p>
<ul>
<li><a href="https://airflow.apache.org/installation.html#extra-packages">Airflow packages</a> may not be what you want. See
  librabbitmq and celery. It's best to manage a requirements.txt or conda.txt with your dependencies still.</li>
<li>Dependency management across multiple dags. In short with a standard setup you need one package version and it needs
  to be installed everywhere. For an interesting approach to this
  read <a href="https://medium.com/bluecore-engineering/were-all-using-airflow-wrong-and-how-to-fix-it-a56f14cb0753">We’re All Using Airflow Wrong and How to Fix It</a></li>
<li>Silent failures. Be aware of all the reasons why a worker may provide exit code 0 especially with docker. This took a
  minute to catch when an NFS mount stopped showing new files being available, but the exit code 0 made things seem ok.
  This isn’t Airflows fault, but just something to keep in mind when using Airflow in an environment with docker and
  remote resources.</li>
</ul>
<h4 id="reaching-out"><a class="toclink" href="../../2018/12/22/docker-airflow/#reaching-out">Reaching out</a></h4>
<p>Hopefully this post helps you get started with <a href="https://github.com/puckel/docker-airflow">docker-airflow</a>. If you have
questions or want to share something cool that you end up doing feel free to open up
an <a href="https://todo.sr.ht/%7En0mn0m/Airflow-Bugs">issue</a> on Sourcehut or reach out to
me <a href="mailto:n0mn0m@burningdaylight.io">n0mn0m@burningdaylight.io</a>.</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2018-10-27 00:00:00+00:00">October 27, 2018</time></li>
        
        
          
          <li class="md-meta__item">
            
              6 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="dealing-with-null-in-pyspark-transformations"><a class="toclink" href="../../2018/10/27/dealing-with-null-in-pyspark-transformations/">Dealing with NULL in PySpark transformations</a></h2>
<p>Lately I’ve been dealing with nested data on a semi regular basis with PySpark. One of the scenarios that tends to come
up a lot is to apply transformations to semi/unstructured data to generate a tabular dataset for consumption by data
scientist. When processing and transforming data I’ve previously found it beneficial to make use of the RDD data
structure so that I have the ability to easily apply custom transformations the same way I would if I was interacting
with normal Python data structures, but with the benefit of Spark and the functionality provided by the RDD API.</p>
<p>With my most recent project though I decided to spend more time working with the Spark Dataframe data structure
specifically for the potential performance gains from Catalyst and Tungeston. Along with this Spark offers a set of
complex types for Spark Dataframe columns to make interaction with collection types a little bit easier.</p>
<p>Diving in I immediately used the <a href="https://github.com/databricks/spark-xml">Databricks XML</a> library to load some data
into my dataframe which had a similar shape (although different contents) to this:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql</span><span class="w"> </span><span class="kn">import</span> <span class="n">Row</span>  
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql.functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">explode</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">monotonicallyincreasingid</span><span class="p">,</span> <span class="n">when</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">lit</span>  
<span class="kn">from</span><span class="w"> </span><span class="nn">pyspark.sql.column</span><span class="w"> </span><span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">tojavacolumn</span>  

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">([</span>  
 <span class="n">Row</span><span class="p">(</span><span class="n">dataCells</span><span class="o">=</span><span class="p">[</span><span class="n">Row</span><span class="p">(</span><span class="n">posx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">posy</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">posz</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="n">Row</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)]),</span>  
 <span class="n">Row</span><span class="p">(</span><span class="n">posx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">posy</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">posz</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[]),</span>  
 <span class="n">Row</span><span class="p">(</span><span class="n">posx</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">posy</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">posz</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">7.5</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="n">Row</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;circle&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mf">.5</span><span class="p">)])</span>  
 <span class="p">])</span>  
<span class="p">])</span>  

<span class="n">df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>  

 <span class="n">root</span>  
 <span class="o">|--</span> <span class="n">dataCells</span><span class="p">:</span> <span class="n">array</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>  
 <span class="o">|</span> <span class="o">|--</span> <span class="n">element</span><span class="p">:</span> <span class="n">struct</span> <span class="p">(</span><span class="n">containsNull</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>  
 <span class="o">|</span> <span class="o">|</span> <span class="o">|--</span> <span class="n">posx</span><span class="p">:</span> <span class="n">long</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>  
 <span class="o">|</span> <span class="o">|</span> <span class="o">|--</span> <span class="n">posy</span><span class="p">:</span> <span class="n">long</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>  
 <span class="o">|</span> <span class="o">|</span> <span class="o">|--</span> <span class="n">posz</span><span class="p">:</span> <span class="n">double</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>  
 <span class="o">|</span> <span class="o">|</span> <span class="o">|--</span> <span class="n">shape</span><span class="p">:</span> <span class="n">array</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>  
 <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|--</span> <span class="n">element</span><span class="p">:</span> <span class="n">struct</span> <span class="p">(</span><span class="n">containsNull</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>  
 <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|--</span> <span class="nb">len</span><span class="p">:</span> <span class="n">long</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>  
 <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|--</span> <span class="nb">type</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>  
 <span class="o">|</span> <span class="o">|</span> <span class="o">|--</span> <span class="n">value</span><span class="p">:</span> <span class="n">double</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  

 <span class="o">+--------------------+</span>  
 <span class="o">|</span> <span class="n">dataCells</span><span class="o">|</span>  
 <span class="o">+--------------------+</span>  
 <span class="o">|</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="o">...|</span>  
 <span class="o">+--------------------+</span>
</code></pre></div>
<p>Perfect. Nothing too crazy, but I wanted to transform the nested array of structs into column representing the members
of each struct type. So I started by looking at the options available to flatten my array column and I came across which
appeared to do exactly what I needed. Next I needed to take the member attributes of the structs and turn those into
columns. I wasn’t able to find a built in function for this, but using the select syntax available on dataframes along
with the* wildcard available on structs I was able to write my own function to do this.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">flattenstructcols</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>  
 <span class="n">flatcols</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">dtypes</span> <span class="k">if</span> <span class="s1">&#39;struct&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">column</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">6</span><span class="p">]]</span>  
 <span class="n">structcolumns</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">dtypes</span> <span class="k">if</span> <span class="s1">&#39;struct&#39;</span> <span class="ow">in</span> <span class="n">column</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">6</span><span class="p">]]</span>  

 <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">flatcols</span> <span class="o">+</span>  
 <span class="p">[</span><span class="n">col</span><span class="p">(</span><span class="n">sc</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">sc</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span>  
 <span class="k">for</span> <span class="n">sc</span> <span class="ow">in</span> <span class="n">structcolumns</span>  
 <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">sc</span> <span class="o">+</span> <span class="s1">&#39;.*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">])</span>  

 <span class="k">return</span> <span class="n">dfAnd</span> <span class="k">with</span> <span class="n">that</span> <span class="n">out</span> <span class="n">of</span> <span class="n">the</span> <span class="n">way</span> <span class="n">I</span><span class="err">’</span><span class="n">m</span> <span class="n">ready</span> <span class="n">to</span> <span class="n">go</span><span class="o">.</span>

<span class="n">flatdf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;dataCells&#39;</span><span class="p">,</span> <span class="n">explode</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;dataCells&#39;</span><span class="p">)))</span>  
<span class="n">flatdf</span> <span class="o">=</span> <span class="n">flattenstructcols</span><span class="p">(</span><span class="n">flatdf</span><span class="p">)</span>  
<span class="n">flatdf</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  

 <span class="o">+--------------|--------------|--------------|---------------|---------------+</span>  
 <span class="o">|</span><span class="n">dataCellsposx</span><span class="o">|</span><span class="n">dataCellsposy</span><span class="o">|</span><span class="n">dataCellsposz</span><span class="o">|</span><span class="n">dataCellsshape</span><span class="o">|</span><span class="n">dataCellsvalue</span><span class="o">|</span>  
 <span class="o">+--------------|--------------|--------------|---------------|---------------+</span>  
 <span class="o">|</span> <span class="mi">0</span><span class="o">|</span> <span class="mi">1</span><span class="o">|</span> <span class="mf">0.5</span><span class="o">|</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="n">square</span><span class="p">]]</span><span class="o">|</span> <span class="mf">1.5</span><span class="o">|</span>  
 <span class="o">|</span> <span class="mi">1</span><span class="o">|</span> <span class="mi">3</span><span class="o">|</span> <span class="mf">0.5</span><span class="o">|</span> <span class="p">[]</span><span class="o">|</span> <span class="mf">4.5</span><span class="o">|</span>  
 <span class="o">|</span> <span class="mi">2</span><span class="o">|</span> <span class="mi">5</span><span class="o">|</span> <span class="mf">0.5</span><span class="o">|</span> <span class="p">[[,</span> <span class="n">circle</span><span class="p">]]</span><span class="o">|</span> <span class="mf">7.5</span><span class="o">|</span>  
 <span class="o">+--------------|--------------|--------------|---------------|---------------+</span>
 <span class="n">flatdf</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>  

 <span class="n">root</span>  
 <span class="o">|--</span> <span class="n">dataCellsposx</span><span class="p">:</span> <span class="n">long</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>  
 <span class="o">|--</span> <span class="n">dataCellsposy</span><span class="p">:</span> <span class="n">long</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>  
 <span class="o">|--</span> <span class="n">dataCellsposz</span><span class="p">:</span> <span class="n">double</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>  
 <span class="o">|--</span> <span class="n">dataCellsshape</span><span class="p">:</span> <span class="n">array</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>  
 <span class="o">|</span> <span class="o">|--</span> <span class="n">element</span><span class="p">:</span> <span class="n">struct</span> <span class="p">(</span><span class="n">containsNull</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>  
 <span class="o">|</span> <span class="o">|</span> <span class="o">|--</span> <span class="nb">len</span><span class="p">:</span> <span class="n">long</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>  
 <span class="o">|</span> <span class="o">|</span> <span class="o">|--</span> <span class="nb">type</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>  
 <span class="o">|--</span> <span class="n">dataCellsvalue</span><span class="p">:</span> <span class="n">double</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span><span class="n">So</span> <span class="n">far</span> <span class="n">so</span> <span class="n">good</span><span class="o">.</span> <span class="n">Let</span><span class="err">’</span><span class="n">s</span> <span class="k">try</span> <span class="n">it</span> <span class="n">again</span><span class="p">,</span> <span class="ow">and</span> <span class="k">if</span> <span class="nb">all</span> <span class="n">goes</span> <span class="n">well</span> <span class="n">we</span> <span class="n">can</span> <span class="n">throw</span> <span class="n">this</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">loop</span><span class="p">,</span> <span class="n">flatten</span> <span class="n">nested</span> <span class="n">columns</span> <span class="ow">and</span> <span class="n">be</span> <span class="n">on</span> <span class="n">our</span> <span class="n">way</span><span class="o">.</span>

<span class="n">flatdf</span> <span class="o">=</span> <span class="n">flatdf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;dataCellsshape&#39;</span><span class="p">,</span> <span class="n">explode</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;dataCellsshape&#39;</span><span class="p">)))</span>  
<span class="n">flatdf</span> <span class="o">=</span> <span class="n">flattenstructcols</span><span class="p">(</span><span class="n">flatdf</span><span class="p">)</span>  
<span class="n">flatdf</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  

 <span class="o">+--------------|--------------|--------------|---------------|--------------------|---------------------+</span>  
 <span class="o">|</span><span class="n">dataCellsposx</span><span class="o">|</span><span class="n">dataCellsposy</span><span class="o">|</span><span class="n">dataCellsposz</span><span class="o">|</span><span class="n">dataCellsvalue</span><span class="o">|</span><span class="n">dataCellsshapelen</span><span class="o">|</span><span class="n">dataCellsshapetype</span><span class="o">|</span>  
 <span class="o">+--------------|--------------|--------------|---------------|--------------------|---------------------+</span>  
 <span class="o">|</span> <span class="mi">0</span><span class="o">|</span> <span class="mi">1</span><span class="o">|</span> <span class="mf">0.5</span><span class="o">|</span> <span class="mf">1.5</span><span class="o">|</span> <span class="mi">1</span><span class="o">|</span> <span class="n">square</span><span class="o">|</span>  
 <span class="o">|</span> <span class="mi">2</span><span class="o">|</span> <span class="mi">5</span><span class="o">|</span> <span class="mf">0.5</span><span class="o">|</span> <span class="mf">7.5</span><span class="o">|</span> <span class="n">null</span><span class="o">|</span> <span class="n">circle</span><span class="o">|</span>  
 <span class="o">+--------------|--------------|--------------|---------------|--------------------|---------------------+</span>
</code></pre></div>
<p>And now we have a problem. After back tracking I found that explode is silently dropping out my row with null in it.
Let's check
the <a href="https://spark.apache.org/docs/2.2.0/api/python/pyspark.sql.html?highlight=date#pyspark.sql.functions.explode">docs</a>.
Interestingly I didn't see anything about this. So I checked the latest docs and just so happened to
notice<a href="https://spark.apache.org/docs/latest/api/python/pyspark.sql.html?highlight=date#pyspark.sql.functions.explode_outer">explodeouter</a>
listed right below this. It turns out in 2.2.0 a set ofouter functions where added that retain null for certain
operations such as explode. Unfortunately some of these are not available in PySpark until 2.3 and I didn't have the
option to migrate from 2.2.x to 2.3.x.</p>
<p><a href="https://stackoverflow.com/questions/52747258/pyspark-2-2-explode-dropping-null-rows-how-to-implement-explode-outer">StackOverflow</a>
to the rescue. After reviewing the PySpark tag I didn't find any solutions with accepted answers so I went ahead and
wrote my own question. Thanks to that I learned a lot about PySpark/JVM interop and about some of the disparities
between the JVM API and other language APIs.</p>
<h4 id="otherwise"><a class="toclink" href="../../2018/10/27/dealing-with-null-in-pyspark-transformations/#otherwise">Otherwise()</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">flatdf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;dataCells&#39;</span><span class="p">,</span> <span class="n">explode</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;dataCells&#39;</span><span class="p">)))</span>  
<span class="n">flatdf</span> <span class="o">=</span> <span class="n">flattenstructcols</span><span class="p">(</span><span class="n">flatdf</span><span class="p">)</span>  
<span class="n">flatdf</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;dataCellsshapetest&#39;</span><span class="p">,</span> <span class="n">explode</span><span class="p">(</span><span class="n">when</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;dataCellsshape&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isNotNull</span><span class="p">(),</span> <span class="n">col</span><span class="p">(</span><span class="s1">&#39;dataCellsshape&#39;</span><span class="p">))</span>  
 <span class="o">.</span><span class="n">otherwise</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">lit</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">flatdf</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;dataCellsshape&#39;</span><span class="p">)</span>  
 <span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>  
 <span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])))))</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  

<span class="o">+--------------|--------------|--------------|---------------|---------------|--------------------+</span>  
<span class="o">|</span><span class="n">dataCellsposx</span><span class="o">|</span><span class="n">dataCellsposy</span><span class="o">|</span><span class="n">dataCellsposz</span><span class="o">|</span><span class="n">dataCellsshape</span><span class="o">|</span><span class="n">dataCellsvalue</span><span class="o">|</span><span class="n">dataCellsshapetest</span><span class="o">|</span>  
<span class="o">+--------------|--------------|--------------|---------------|---------------|--------------------+</span>  
<span class="o">|</span> <span class="mi">0</span><span class="o">|</span> <span class="mi">1</span><span class="o">|</span> <span class="mf">0.5</span><span class="o">|</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="n">square</span><span class="p">]]</span><span class="o">|</span> <span class="mf">1.5</span><span class="o">|</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">square</span><span class="p">]</span><span class="o">|</span>  
<span class="o">|</span> <span class="mi">2</span><span class="o">|</span> <span class="mi">5</span><span class="o">|</span> <span class="mf">0.5</span><span class="o">|</span> <span class="p">[[,</span> <span class="n">circle</span><span class="p">]]</span><span class="o">|</span> <span class="mf">7.5</span><span class="o">|</span> <span class="p">[,</span> <span class="n">circle</span><span class="p">]</span><span class="o">|</span>  
<span class="o">+--------------|--------------|--------------|---------------|---------------|--------------------+</span>
</code></pre></div>
<p>Based on some responses to my question I found another question that provided a scala solution involving .otherwise and
casting the nested structure with a null literal. None in Python. This seemed like the more direct solution without
making use of private functionality in the library, so I opted to try implementing the scala solution in PySpark first.</p>
<p>But unfortunately it appears that the explode may have a precedence behind the scenes that drops the row before
otherwise is evaluated. With a quickly approaching deadline I unfortunately did not have time to dig deep into why this
was with other options on the table.</p>
<h4 id="into-the-jvm"><a class="toclink" href="../../2018/10/27/dealing-with-null-in-pyspark-transformations/#into-the-jvm">Into the JVM</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">explodeouter</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>  
<span class="w"> </span><span class="sd">&quot;&quot;&quot;  </span>
<span class="sd"> Calling the explodeouter Java function from PySpark  </span>
<span class="sd"> &quot;&quot;&quot;</span>  
 <span class="n">explodeouter</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">jvm</span><span class="o">.</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">explodeouter</span>  
 <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="n">explodeouter</span><span class="p">(</span><span class="n">tojavacolumn</span><span class="p">(</span><span class="n">col</span><span class="p">)))</span><span class="n">flatdfwithnull</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;dataCells&#39;</span><span class="p">,</span> <span class="n">explode</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;dataCells&#39;</span><span class="p">)))</span>  
<span class="n">flatdfwithnull</span> <span class="o">=</span> <span class="n">flattenstructcols</span><span class="p">(</span><span class="n">flatdfwithnull</span><span class="p">)</span>  
<span class="n">flatdfwithnull</span> <span class="o">=</span> <span class="n">flatdfwithnull</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;dataCellsshape&quot;</span><span class="p">,</span> <span class="n">explodeouter</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;dataCellsshape&quot;</span><span class="p">)))</span>  
<span class="n">flatdfwithnull</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  

 <span class="o">+--------------|--------------|--------------|---------------|---------------+</span>  
 <span class="o">|</span><span class="n">dataCellsposx</span><span class="o">|</span><span class="n">dataCellsposy</span><span class="o">|</span><span class="n">dataCellsposz</span><span class="o">|</span><span class="n">dataCellsshape</span><span class="o">|</span><span class="n">dataCellsvalue</span><span class="o">|</span>  
 <span class="o">+--------------|--------------|--------------|---------------|---------------+</span>  
 <span class="o">|</span> <span class="mi">0</span><span class="o">|</span> <span class="mi">1</span><span class="o">|</span> <span class="mf">0.5</span><span class="o">|</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">square</span><span class="p">]</span><span class="o">|</span> <span class="mf">1.5</span><span class="o">|</span>  
 <span class="o">|</span> <span class="mi">1</span><span class="o">|</span> <span class="mi">3</span><span class="o">|</span> <span class="mf">0.5</span><span class="o">|</span> <span class="n">null</span><span class="o">|</span> <span class="mf">4.5</span><span class="o">|</span>  
 <span class="o">|</span> <span class="mi">2</span><span class="o">|</span> <span class="mi">5</span><span class="o">|</span> <span class="mf">0.5</span><span class="o">|</span> <span class="p">[,</span> <span class="n">circle</span><span class="p">]</span><span class="o">|</span> <span class="mf">7.5</span><span class="o">|</span>  
 <span class="o">+--------------|--------------|--------------|---------------|---------------+</span>
 <span class="n">flatdfwithnull</span> <span class="o">=</span> <span class="n">flattenstructcols</span><span class="p">(</span><span class="n">flatdfwithnull</span><span class="p">)</span>  
<span class="n">flatdfwithnull</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  

 <span class="o">+--------------|--------------|--------------|---------------|--------------------|---------------------+</span>  
 <span class="o">|</span><span class="n">dataCellsposx</span><span class="o">|</span><span class="n">dataCellsposy</span><span class="o">|</span><span class="n">dataCellsposz</span><span class="o">|</span><span class="n">dataCellsvalue</span><span class="o">|</span><span class="n">dataCellsshapelen</span><span class="o">|</span><span class="n">dataCellsshapetype</span><span class="o">|</span>  
 <span class="o">+--------------|--------------|--------------|---------------|--------------------|---------------------+</span>  
 <span class="o">|</span> <span class="mi">0</span><span class="o">|</span> <span class="mi">1</span><span class="o">|</span> <span class="mf">0.5</span><span class="o">|</span> <span class="mf">1.5</span><span class="o">|</span> <span class="mi">1</span><span class="o">|</span> <span class="n">square</span><span class="o">|</span>  
 <span class="o">|</span> <span class="mi">1</span><span class="o">|</span> <span class="mi">3</span><span class="o">|</span> <span class="mf">0.5</span><span class="o">|</span> <span class="mf">4.5</span><span class="o">|</span> <span class="n">null</span><span class="o">|</span> <span class="n">null</span><span class="o">|</span>  
 <span class="o">|</span> <span class="mi">2</span><span class="o">|</span> <span class="mi">5</span><span class="o">|</span> <span class="mf">0.5</span><span class="o">|</span> <span class="mf">7.5</span><span class="o">|</span> <span class="n">null</span><span class="o">|</span> <span class="n">circle</span><span class="o">|</span>  
 <span class="o">+--------------|--------------|--------------|---------------|--------------------|---------------------+</span>
</code></pre></div>
<p>While reviewing suggested solutions I found out that SparkContext has ajvm object that provides access to org.apache.*
functionality. Along with this I also noticed that Databricks has an entire "private" api used with Python and Java.
Part of this API istojavacolumn which makes it possible to transform a PySpark column to a Java column to match Java
method signatures.
Learning all of this, and knowing that the Java API already had <code>explodeouter</code> implemented I reviewed the
Java <a href="https://spark.apache.org/docs/2.3.0/api/java/index.html">explodeouter</a> method to verify the type signature and
built my own function in Python to call the Java function and return the column with null in place.</p>
<p>And it works! With that I am able to flatten out arbitrarily nested collections in PySpark dataframes while retaining
nulls when using Spark 2.2.x.</p>
<h4 id="wrapping-up"><a class="toclink" href="../../2018/10/27/dealing-with-null-in-pyspark-transformations/#wrapping-up">Wrapping Up</a></h4>
<p>A couple of things to note; if you have an array with more than one struct as a member this will fail, and if you have a
deeply nested structure the growth of this transformation is typically not sustainable on a large dataset.</p>
<p>I have questions that I hope to continue spending time on. For instance why are rows with null dropped at all? I wonder
if the operation makes a new dataframe from the column to apply the operation to and then joins it back on an index and
along the way that join loses nulls. Why are functions that are lossy not identified as such? Is there always a version
lag between the JVM api and the PySpark api? I'm also curious how Catalyst handles denesting operations and adding new
columns from the result of exploding arrays or flattening structs.</p>
<p>Finally instead of adding new columns I want to try using the MapType to instead create a new column of key, value pairs
that allows me to flatten out arbitrarily deep collections into a MapType so that I can use the same methodology on much
deeper structures without adding a lot of columns that are mostly null.</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2018-10-25 00:00:00+00:00">October 25, 2018</time></li>
        
        
          
          <li class="md-meta__item">
            
              1 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="derbypy-intro-to-pyspark"><a class="toclink" href="../../2018/10/25/derbypy-intro-to-pyspark/">DerbyPy Intro to PySpark</a></h2>
<p>This month at <a href="https://www.meetup.com/derbypy/">DerbyPy</a> I provided a high level introduction to PySpark. For this talk
I went over the Spark execution model at a high level, talked about the difference between the PySpark Dataframe and RDD
api, and provided some examples of how to use both. As part of this I put together a jupyter notebook and some scripts
that can be used via spark-submit along with instructions on how to run PySpark locally.</p>
<p>If you’re interested in the material and presentation they can be found <a href="https://github.com/n0mn0m/presentations">here</a>.</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2018-10-09 00:00:00+00:00">October 9, 2018</time></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="derbypy-introduction-to-python-modules-and-packages"><a class="toclink" href="../../2018/10/09/derbypy-introduction-to-python-modules-and-packages/">DerbyPy Introduction to Python Modules and Packages</a></h2>
<p>Most programming languages offer ways to organize your code into namespaces. These namespaces are logical containers
that group different names and behaviors together and isolate them to that namespace. By organizing your code with
namespaces it makes it easier to structure your application without naming collisions and it can make it easier for you
and others to maintain your code by adding some additional organization to your project.</p>
<p>In Python we can use modules and packages to create namespaces that we can then reference in other modules as we build
our application.</p>
<p>A Python module is a .py file containing Python definitions and statements. The file name is the module name with the
suffix.py appended.</p>
<p>As with all things in Python when we import a module it is an object, and just like other objects it has dunder (double
underscore) attributes that define additional data about that module. We can use that to learn more about the module
before we ever start to use it.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pprintext</span>  

<span class="nb">print</span><span class="p">(</span><span class="n">pprintext</span><span class="o">.</span><span class="n">doc</span><span class="p">)</span>  
<span class="nb">print</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">pprintext</span><span class="p">))</span>  
 <span class="n">A</span> <span class="n">module</span> <span class="n">providing</span> <span class="n">extensions</span> <span class="n">to</span> <span class="n">pretty</span> <span class="nb">print</span> <span class="n">structures</span> <span class="n">that</span> <span class="n">pprint</span> <span class="n">may</span> <span class="ow">not</span> <span class="n">handle</span> <span class="n">well</span><span class="o">.</span>  

 <span class="p">[</span><span class="s1">&#39;builtins&#39;</span><span class="p">,</span> <span class="s1">&#39;cached&#39;</span><span class="p">,</span> <span class="s1">&#39;doc&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span> <span class="s1">&#39;loader&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;package&#39;</span><span class="p">,</span> <span class="s1">&#39;spec&#39;</span><span class="p">,</span> <span class="s1">&#39;listdirectory&#39;</span><span class="p">,</span> <span class="s1">&#39;os&#39;</span><span class="p">]</span><span class="n">From</span> <span class="n">the</span> <span class="n">output</span> <span class="n">of</span> <span class="nb">dir</span><span class="p">()</span> <span class="n">we</span> <span class="n">can</span> <span class="n">see</span> <span class="n">there</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">function</span> <span class="n">called</span> <span class="n">listdirectory</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">part</span> <span class="n">of</span> <span class="n">this</span> <span class="n">module</span><span class="o">.</span>

<span class="n">pprintext</span><span class="o">.</span><span class="n">listdirectory</span><span class="p">(</span><span class="s2">&quot;plugins&quot;</span><span class="p">)</span>  

 <span class="n">plugins</span><span class="o">/</span>  
 <span class="n">ipynb</span><span class="o">/</span>  
 <span class="n">init</span><span class="o">.</span><span class="n">py</span>  
 <span class="n">liquid</span><span class="o">.</span><span class="n">py</span>  
 <span class="n">markup</span><span class="o">.</span><span class="n">py</span>  
 <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>  
 <span class="o">.</span><span class="n">git</span>  
 <span class="n">README</span><span class="o">.</span><span class="n">md</span>  
 <span class="n">ipynb</span><span class="o">.</span><span class="n">py</span>  
 <span class="n">LICENSE</span>  
 <span class="o">.</span><span class="n">gitignore</span>  
 <span class="n">core</span><span class="o">.</span><span class="n">py</span>  
 <span class="n">pycache</span><span class="o">/</span>  
 <span class="n">core</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">36.</span><span class="n">pyc</span>  
 <span class="n">init</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">36.</span><span class="n">pyc</span>  
 <span class="n">markup</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">36.</span><span class="n">pyc</span>  
 <span class="n">ipynb</span><span class="o">.</span><span class="n">cpython</span><span class="o">-</span><span class="mf">36.</span><span class="n">pyc</span>  
 <span class="n">tests</span><span class="o">/</span>  
 <span class="n">pelican</span><span class="o">/</span>  
 <span class="n">pelicanconfmarkup</span><span class="o">.</span><span class="n">py</span>  
 <span class="n">pelicanconfliquid</span><span class="o">.</span><span class="n">py</span>  
 <span class="n">theme</span><span class="o">/</span>  
 <span class="n">templates</span><span class="o">/</span>  
 <span class="n">base</span><span class="o">.</span><span class="n">html</span>  
 <span class="n">content</span><span class="o">/</span>  
 <span class="k">with</span><span class="o">-</span><span class="n">meta</span><span class="o">-</span><span class="n">file</span><span class="o">.</span><span class="n">ipynb</span><span class="o">-</span><span class="n">meta</span>  
 <span class="k">with</span><span class="o">-</span><span class="n">liquid</span><span class="o">-</span><span class="n">tag</span><span class="o">.</span><span class="n">ipynb</span>  
 <span class="k">with</span><span class="o">-</span><span class="n">metacell</span><span class="o">.</span><span class="n">ipynb</span>  
 <span class="k">with</span><span class="o">-</span><span class="n">meta</span><span class="o">-</span><span class="n">file</span><span class="o">.</span><span class="n">ipynb</span>  
 <span class="k">with</span><span class="o">-</span><span class="n">liquid</span><span class="o">-</span><span class="n">tag</span><span class="o">.</span><span class="n">md</span>
</code></pre></div>
<p>Finally, we can see where we are importing this module from with .file and we see that this is a module local to our
application.</p>
<div class="highlight"><pre><span></span><code><span class="n">pprintext</span><span class="o">.</span><span class="n">file</span> <span class="s1">&#39;/home/alex/projects/alexhagerman.github.io/pprintext.py&#39;</span><span class="c1">### Packages</span>
</code></pre></div>
<p>For the sake of brevity and simplicity tonight we can say that a Python package is a collection of Python modules. It is
a folder that contains .py file and provides a parent namespace for the modules in the folder.</p>
<p>Another way of saying this is:</p>
<p>Just like we did with our module we can call dir() on our package to see associated attributes and objects.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pprintextension</span>  
<span class="nb">dir</span><span class="p">(</span><span class="n">pprintextension</span><span class="p">)</span>  

 <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>  
 <span class="s1">&#39;builtins&#39;</span><span class="p">,</span>  
 <span class="s1">&#39;cached&#39;</span><span class="p">,</span>  
 <span class="s1">&#39;doc&#39;</span><span class="p">,</span>  
 <span class="s1">&#39;file&#39;</span><span class="p">,</span>  
 <span class="s1">&#39;loader&#39;</span><span class="p">,</span>  
 <span class="s1">&#39;name&#39;</span><span class="p">,</span>  
 <span class="s1">&#39;package&#39;</span><span class="p">,</span>  
 <span class="s1">&#39;path&#39;</span><span class="p">,</span>  
 <span class="s1">&#39;spec&#39;</span><span class="p">,</span>  
 <span class="s1">&#39;network&#39;</span><span class="p">,</span>  
 <span class="s1">&#39;pprintextension&#39;</span><span class="p">]</span>
</code></pre></div>
<p>Additionally, we can call help which may provide more information about the package defined in init.py. You can think of
init.py as a place to put initialization behavior and documentation for your package. In the way thatinit handles
initializing your class init.py handles the initialization of your package during import.init.py used to be required to
make a directory a package, but as of Python 3.3 thanks to pep-420 it is no longer required. More links and information
are provided at the end of the notebook.</p>
<div class="highlight"><pre><span></span><code><span class="n">help</span><span class="p">(</span><span class="n">pprintextension</span><span class="p">)</span>  

 <span class="n">Help</span> <span class="n">on</span> <span class="n">package</span> <span class="n">pprintextension</span><span class="p">:</span>  

 <span class="n">NAME</span>  
 <span class="n">pprintextension</span>  

 <span class="n">DESCRIPTION</span>  
 <span class="n">A</span> <span class="n">package</span> <span class="n">providing</span> <span class="n">functions</span> <span class="n">to</span> <span class="n">pretty</span> <span class="nb">print</span> <span class="n">structures</span> <span class="n">that</span> <span class="n">may</span> <span class="n">have</span> <span class="n">alternative</span> <span class="n">renderings</span> <span class="kn">from</span><span class="w"> </span><span class="nn">the</span> <span class="n">standard</span>  
 <span class="n">pprint</span> <span class="n">package</span><span class="o">.</span>  

 <span class="n">PACKAGE</span> <span class="n">CONTENTS</span>  
 <span class="n">filesystem</span>  
 <span class="n">network</span>  

 <span class="n">DATA</span>  
 <span class="nb">all</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;filesystem&#39;</span><span class="p">]</span>  

 <span class="n">FILE</span>  
 <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">alex</span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">modules</span><span class="o">-</span><span class="ow">and</span><span class="o">-</span><span class="n">packages</span><span class="o">-</span><span class="n">into</span><span class="o">/</span><span class="n">pprintextension</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">pyAdditionally</span> <span class="n">we</span> <span class="n">can</span> <span class="kn">import</span><span class="w"> </span><span class="nn">modules</span> <span class="kn">from</span><span class="w"> </span><span class="nn">packages</span> <span class="ow">and</span> <span class="n">refer</span> <span class="n">to</span> <span class="n">them</span> <span class="n">directly</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">using</span> <span class="n">the</span> <span class="n">fully</span> <span class="n">qualified</span> <span class="n">namespacing</span> <span class="n">syntax</span> <span class="o">&lt;</span><span class="n">package</span><span class="o">&gt;.&lt;</span><span class="n">module</span><span class="o">&gt;.&lt;</span><span class="nb">object</span><span class="o">&gt;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pprintextension</span><span class="w"> </span><span class="kn">import</span> <span class="n">filesystem</span>  
<span class="n">filesystem</span><span class="o">.</span><span class="n">listhiddendirectory</span><span class="p">()</span>  

 <span class="o">./</span>  
 <span class="o">.</span><span class="n">ipynbcheckpoints</span><span class="o">/</span>  
 <span class="o">.</span><span class="n">git</span><span class="o">/</span>  
 <span class="o">.</span><span class="n">idea</span><span class="o">/</span><span class="n">Packages</span> <span class="n">go</span> <span class="n">way</span> <span class="n">beyond</span> <span class="n">what</span> <span class="n">we</span> <span class="n">have</span> <span class="n">covered</span> <span class="n">here</span><span class="o">.</span> <span class="n">As</span> <span class="n">you</span> <span class="n">build</span> <span class="n">packages</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">consider</span> <span class="n">their</span> <span class="n">structure</span> <span class="n">relative</span> <span class="n">to</span> <span class="n">the</span> <span class="n">public</span> <span class="n">API</span> <span class="n">you</span><span class="err">’</span><span class="n">re</span> <span class="n">creating</span><span class="o">.</span> <span class="n">Publishing</span> <span class="ow">and</span> <span class="n">distributing</span> <span class="n">packages</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">talk</span> <span class="ow">or</span> <span class="n">series</span> <span class="n">of</span> <span class="n">talks</span> <span class="n">on</span> <span class="n">its</span> <span class="n">own</span><span class="o">.</span> <span class="n">For</span> <span class="n">now</span> <span class="n">what</span> <span class="n">we</span> <span class="n">have</span> <span class="n">covered</span> <span class="ow">is</span> <span class="n">how</span> <span class="n">we</span> <span class="n">can</span> <span class="n">group</span> <span class="n">modules</span> <span class="n">together</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">package</span> <span class="ow">and</span> <span class="n">some</span> <span class="n">basics</span> <span class="k">for</span> <span class="n">how</span> <span class="n">to</span> <span class="n">control</span> <span class="n">the</span> <span class="n">initialization</span> <span class="n">behavior</span> <span class="n">of</span> <span class="n">a</span> <span class="n">package</span><span class="o">.</span>
</code></pre></div>
<h4 id="finishing-up"><a class="toclink" href="../../2018/10/09/derbypy-introduction-to-python-modules-and-packages/#finishing-up">Finishing up</a></h4>
<p>Now that we know what a Python module and package is next month we will look at the import statement. As a sneak peak
I'll leave you with sys.path and you can begin exploring how this relates to our own packages and modules that make up
our application as well as those we might install with tools such as pip or conda.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>  
<span class="n">sys</span><span class="o">.</span><span class="n">path</span>  

 <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span>  
 <span class="s1">&#39;/home/alex/miniconda3/envs/blogging/lib/python36.zip&#39;</span><span class="p">,</span>  
 <span class="s1">&#39;/home/alex/miniconda3/envs/blogging/lib/python3.6&#39;</span><span class="p">,</span>  
 <span class="s1">&#39;/home/alex/miniconda3/envs/blogging/lib/python3.6/lib-dynload&#39;</span><span class="p">,</span>  
 <span class="s1">&#39;/home/alex/miniconda3/envs/blogging/lib/python3.6/site-packages&#39;</span><span class="p">,</span>  
 <span class="s1">&#39;/home/alex/miniconda3/envs/blogging/lib/python3.6/site-packages/IPython/extensions&#39;</span><span class="p">,</span>  
 <span class="s1">&#39;/home/alex/.ipython&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">docs</span><span class="o">.</span><span class="n">python</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="mi">3</span><span class="o">/</span><span class="n">library</span><span class="o">/</span><span class="n">sys</span><span class="o">.</span><span class="n">html</span><span class="c1">#sys.path&gt;</span>
</code></pre></div>
<h4 id="additional-reading"><a class="toclink" href="../../2018/10/09/derbypy-introduction-to-python-modules-and-packages/#additional-reading">Additional Reading</a></h4>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2018-06-29 00:00:00+00:00">June 29, 2018</time></li>
        
        
          
          <li class="md-meta__item">
            
              4 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="recursive-search-with-python"><a class="toclink" href="../../2018/06/29/recursive-search-with-python/">Recursive Search with Python</a></h2>
<p>Recently I received from JSON like data that I needed to transform into a tabular dataset. As part of that there was a
specific key that could occur as a child of different keys at different depths in the structure. Not only could the key
I needed appear at different locations and depths, but when it was located it was possible that it would have N sibling
occurrences I needed to retrieve at the same location. Finally for all of these there were a set of id and date keys at
the top level of the structure that I was asked to include with each search key result.</p>
<p>I took a couple different paths on my way to solving this. One of the first things I found was the total depth was
inconsistent across the structures. Not only that, but it wasn’t uncommon to find the key scattered across depths up to
5 or 6 levels deep. The function below is what I ended up using. It’s a recursive search that relies on the fact that
the data is JSON like. Instead of trying to pull the parent keys out as part of the search I have a function that parses
out the id and date keys passing those into this function as base. Then a search is performed on the input object
checking the dictionary collections for all instances of the search key and when located appending the search keys value
to the base data, which is then added to a list of results which is returned when the entire collection has been
searched.</p>
<h4 id="gotchas"><a class="toclink" href="../../2018/06/29/recursive-search-with-python/#gotchas">Gotchas</a></h4>
<ul>
<li>This needed to be Python 2 and 3 compatible so pay attention to iterating dictionary keys and values when you have
  this requirement. There are different ways to handle this. I used future.</li>
<li>The way that Python appends to list can be tricky. This bit me when I found that results contained the right number of
  results, but all of my results where the same and where based on the last hit. This is because I was calling append on
  base which was creating bindings that I mutated on each search result. Luckily Python has acopy module in the standard
  library to help with this scenario.</li>
</ul>
<h4 id="problem-solved"><a class="toclink" href="../../2018/06/29/recursive-search-with-python/#problem-solved">Problem Solved</a></h4>
<p>The function below represents my final result. This worked well on the sample data, and eventually was used on PySpark
RDDs to process hundreds of millions of structures quickly.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">copy</span> <span class="kn">from</span><span class="w"> </span><span class="nn">future.utils</span><span class="w">   </span>
<span class="kn">import</span> <span class="n">iteritems</span> 

<span class="k">def</span><span class="w"> </span><span class="nf">search</span> <span class="p">(</span> <span class="nb">input</span> <span class="p">,</span> <span class="n">rowbase</span> <span class="p">,</span> <span class="n">searchkey</span> <span class="p">,</span> <span class="n">results</span> <span class="p">):</span>   
<span class="w">     </span><span class="sd">&quot;&quot;&quot; A search function to help transform nested JSON   </span>
<span class="sd">     like objects into tabular rows. The function takes  </span>
<span class="sd">     a JSON like object as input along with a search key   </span>
<span class="sd">     and returns a row for each occurrence of the key in   </span>
<span class="sd">     the object. rowbase is expected to be a list containing  </span>
<span class="sd">     any base data you would like associated with the   </span>
<span class="sd">     searchkey data.   </span>
<span class="sd">     &quot;&quot;&quot;</span>
     <span class="k">if</span> <span class="nb">input</span> <span class="p">:</span>   
         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">input</span> <span class="p">:</span>   
             <span class="c1"># If input contains a list run it through search   </span>
             <span class="c1"># again since it may contain dictionaries with   </span>
             <span class="c1"># the key being searched   </span>
             <span class="k">if</span> <span class="nb">isinstance</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>   
                 <span class="n">search</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">rowbase</span><span class="p">,</span> <span class="n">searchkey</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>   
             <span class="c1"># If input contains a dictionary check if it   </span>
             <span class="c1"># contains the searchkey. Also check if any of   </span>
             <span class="c1"># the values are list or dictionaries that need   </span>
             <span class="c1"># to be searched   </span>
             <span class="k">if</span> <span class="nb">isinstance</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>   
                 <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">iteritems</span> <span class="p">(</span><span class="n">i</span><span class="p">):</span>   
                 <span class="c1"># If the searchkey is located deepcopy   </span>
                 <span class="c1"># rowbase to prevent changing rowbase   </span>
                 <span class="c1"># on future hits. Create full row and   </span>
                 <span class="c1"># append to results   </span>
                 <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">searchkey</span><span class="p">:</span>   
                     <span class="n">row</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">rowbase</span><span class="p">)</span>   
                     <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  
                     <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>   
                     <span class="k">continue</span>  
             <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>   
                 <span class="n">search</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">rowbase</span><span class="p">,</span> <span class="n">searchkey</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>  
             <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>   
                 <span class="n">search</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">rowbase</span><span class="p">,</span> <span class="n">searchkey</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span>  
         <span class="c1"># Search has been exhausted return search  </span>
         <span class="c1"># results to caller. Results will be a   </span>
         <span class="c1"># list of list. </span>
         <span class="k">return</span> <span class="n">results</span>
</code></pre></div>
<h4 id="next-steps"><a class="toclink" href="../../2018/06/29/recursive-search-with-python/#next-steps">Next Steps</a></h4>
<p>Since this works there are a couple of ideas I want to explore with it.</p>
<ul>
<li>This seems like a good place to gain experience with Python type annotations.</li>
<li>Since this needs to work in a pure Python environment as well as a PySpark environment I want to do some profiling,
  but I’m not sure how tools like Cython or Numba will work/interact with the PySpark piece of this. That will be
  interesting to explore.</li>
<li>It would be interesting to add depth tracking and see if there are any levels where the search key never occurs so
  that the function could potentially skip iteritems at that level.</li>
</ul>
<h4 id="docs"><a class="toclink" href="../../2018/06/29/recursive-search-with-python/#docs">Docs</a></h4>
<p>For more information documentation on copy and future you can check out the documentation.</p>
<p>I’m sure others will have different ideas and approaches to something like this. Or you might have suggestions on
something that could be done to make this faster or easier to read. If you have feedback or suggestion feel free to send
them my way via up via <a href="mailto:n0mn0m@burningdaylight.io">email</a>.</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2018-05-17 00:00:00+00:00">May 17, 2018</time></li>
        
        
          
          <li class="md-meta__item">
            
              2 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="publishing-with-pelican-on-windows"><a class="toclink" href="../../2018/05/17/publishing-with-pelican-on-windows/">Publishing with Pelican on Windows</a></h2>
<p>To get things started I thought it might be a good idea to document using Pelican on Windows with Github and Gandi for
blog publishing. I’ll start by configuring Pelican and Github. Once that’s working I’ll then talk about configuring
Gandi so you can use a custom domain. If you’re using a different domain provider you may need to use different
settings, but Github has plenty of documentation around this that I’ll provide links for. Using Pelican on Windows isn’t
that much different than macOS or Linux, but you won’t find as many tutorials or be able to use the quickstart makefile.</p>
<h4 id="github-pages-setup"><a class="toclink" href="../../2018/05/17/publishing-with-pelican-on-windows/#github-pages-setup">Github Pages Setup</a></h4>
<p>The first thing you should do is login to Github and then setup a Github pages repo. You can read more detailed
istructions here: <a href="https://pages.github.com/">https://pages.github.com/</a> or create a repo that follows the pattern:</p>
<p>I followed a pattern for User Github pages. This will be important when publishing with Pelican.</p>
<p><a href="https://help.github.com/articles/user-organization-and-project-pages/">https://help.github.com/articles/user-organization-and-project-pages/</a></p>
<h4 id="pelican-local"><a class="toclink" href="../../2018/05/17/publishing-with-pelican-on-windows/#pelican-local">Pelican Local</a></h4>
<p>With that out of the way we want to move on to setting up our project on Windows. I’m using Anaconda and I will be
creating a new conda environment for this project.</p>
<p>The main thing to pay attention to when you go through the quickstart prompts is that you won’t need or be able to use
the makefile with Windows. Once you have completed the quikstart there are a couple things to pay attention to.</p>
<ol>
<li>Your articles should be markdown documents in the content folder.</li>
<li>pelicanconf.py contains various settings related to you blog.</li>
<li>publishconf.py can be left alone because we are using ghp-import</li>
</ol>
<h4 id="publishing"><a class="toclink" href="../../2018/05/17/publishing-with-pelican-on-windows/#publishing">Publishing</a></h4>
<p>Go ahead and create a file under content. Something like gettingstarted.md and add some text. Once you’ve done that
switch back to the terminal prompt.</p>
<h4 id="custom-domain-url"><a class="toclink" href="../../2018/05/17/publishing-with-pelican-on-windows/#custom-domain-url">Custom Domain URL</a></h4>
<p>Ok, now that we have Github setup and we can see our blog pages I want to look at the steps required to use my custom
domain hosted by Gandi with the Github pages. With Gandi we want to modify our A Records to allow routing to Github.
Logging into your Gandi dashboard, select domains from the menu and then DNS records. On this page you should be able to
edit your DNS record and add the following:</p>
<p><a href="https://wiki.gandi.net/en/dns/zone/a-record">https://wiki.gandi.net/en/dns/zone/a-record</a></p>
<p>Ok finally navigate back to your Github repo and go to the settings page. Under settings scroll down until you see
Github pages. You should see a textbox allowing you to enter a custom domain. Add that, and if possible I recommend
checking the enforce https box below this.</p>
<h4 id="wrapping-up"><a class="toclink" href="../../2018/05/17/publishing-with-pelican-on-windows/#wrapping-up">Wrapping Up</a></h4>
<p>With that done you should be good to go. Whenever you want to write a new article create a markdown document in the
content folder and follow the same steps above for publishing. One last note if this doesn’t work immediately you might
want to wait before beginning to change settings since your A record changes can take some time to replicate.</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2018-05-08 00:00:00+00:00">May 8, 2018</time></li>
        
        
          
          <li class="md-meta__item">
            
              1 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="getting-started"><a class="toclink" href="../../2018/05/08/getting-started/">Getting Started</a></h2>
<p>I’ve needed to start this for a while. I think most programmers, sys admins, dbas and others work on projects large and
small where we quickly find out how to make x work with y or a produce b. Then we check into source control, walk away
and forget until we need to remember a detail 6 weeks later. So that’s what I plan to record here. Little notes and
snippets of code, settings, whatever might have been on my mind or come across my keyboard in recent days or weeks.
Often times it will have something to do with Python, SQL or clustered systems.</p>
<p>The first few post will be on getting Pelican setup with GitHub Pages and Gandi. After that I’ll probably jump into
PySpark, HBase, Python and execution plans. Chances are if databases, Python or distributed systems are involved I’m
interested in learning and writing about it. If that sounds interesting definitely keep an eye out for more post here.</p>
<p>A little bit about myself. I am currently a data engineer at Humana writing a lot of Python and SQL mixing software
engineering practices with data science projects. Before that I worked at a few different companies focused on the
Microsoft Data Stack mixing SQL Server, SSIS, SSAS and C# to build data intensive applications. There’s more information
on my LinkedIn and GitHub pages.</p>
<p>That’s all for now. More to come soon.</p>
    
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="/feed_rss_updated.xml" target="_blank" rel="noopener" title="RSS Feed" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 64c0-17.7 14.3-32 32-32 229.8 0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7 0 64m0 352a64 64 0 1 1 128 0 64 64 0 1 1-128 0m32-256c159.1 0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7 0-32-14.3-32-32s14.3-32 32-32"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.path", "icons"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
      
    
  </body>
</html>