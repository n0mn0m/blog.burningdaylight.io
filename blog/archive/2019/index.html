
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Alexander Hagerman">
      
      
        <link rel="canonical" href="https://burningdaylight.io/blog/archive/2019/">
      
      
        <link rel="prev" href="../2020/">
      
      
        <link rel="next" href="../2018/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../../icons/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>2019 - burningdaylight</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/styles.css">
    
      <link rel="stylesheet" href="../../../css/portfolio.css">
    
      <link rel="stylesheet" href="../../../css/resume.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="hsl(195,-80%,-42%)" data-md-color-accent="hsl(284,-22%,-36%)">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2019" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://burningdaylight.io" title="burningdaylight" class="md-header__button md-logo" aria-label="burningdaylight" data-md-component="logo">
      
  <img src="../../../icons/favicon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            burningdaylight
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2019
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="hsl(195,-80%,-42%)" data-md-color-accent="hsl(284,-22%,-36%)"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="hsl(284,-22%,-36%)" data-md-color-accent="hsl(195,-80%,-42%)"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://burningdaylight.io" title="burningdaylight" class="md-nav__button md-logo" aria-label="burningdaylight" data-md-component="logo">
      
  <img src="../../../icons/favicon.png" alt="logo">

    </a>
    burningdaylight
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../me/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Me
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archive
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2025/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2025
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2022/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2021/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2021
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2020/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2020
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    
      
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    2019
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    2019
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cleaning-airflow-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Cleaning Airflow Logs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#review-edx-ut601-embedded-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Review EdX UT601 Embedded Systems
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#edgerouter-x-ddns-with-gandi" class="md-nav__link">
    <span class="md-ellipsis">
      EdgeRouter X DDNS with Gandi
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#edgerouter-x-home-vpn-setup-pt-1" class="md-nav__link">
    <span class="md-ellipsis">
      EdgeRouter X Home VPN Setup Pt 1
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#edgerouter-x-home-vpn-setup-pt-2" class="md-nav__link">
    <span class="md-ellipsis">
      EdgeRouter X Home VPN Setup Pt 2
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#edgerouter-x-pihole-setup" class="md-nav__link">
    <span class="md-ellipsis">
      EdgeRouter X PiHole Setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hackaday-connected-world-follow-up" class="md-nav__link">
    <span class="md-ellipsis">
      Hackaday Connected World Follow Up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postgres-advisory-locks-with-asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      Postgres Advisory Locks with Asyncio
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connected-roomba-wrapping-up" class="md-nav__link">
    <span class="md-ellipsis">
      Connected Roomba - Wrapping Up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connected-roomba-sms" class="md-nav__link">
    <span class="md-ellipsis">
      Connected Roomba - SMS
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2018/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2018
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Lists
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Lists
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lists/books/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Books
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../lists/podcast/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Podcast
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Programming
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Programming
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/portfolio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Portfolio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../programming/resume/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resume
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cleaning-airflow-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Cleaning Airflow Logs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#review-edx-ut601-embedded-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Review EdX UT601 Embedded Systems
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#edgerouter-x-ddns-with-gandi" class="md-nav__link">
    <span class="md-ellipsis">
      EdgeRouter X DDNS with Gandi
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#edgerouter-x-home-vpn-setup-pt-1" class="md-nav__link">
    <span class="md-ellipsis">
      EdgeRouter X Home VPN Setup Pt 1
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#edgerouter-x-home-vpn-setup-pt-2" class="md-nav__link">
    <span class="md-ellipsis">
      EdgeRouter X Home VPN Setup Pt 2
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#edgerouter-x-pihole-setup" class="md-nav__link">
    <span class="md-ellipsis">
      EdgeRouter X PiHole Setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hackaday-connected-world-follow-up" class="md-nav__link">
    <span class="md-ellipsis">
      Hackaday Connected World Follow Up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postgres-advisory-locks-with-asyncio" class="md-nav__link">
    <span class="md-ellipsis">
      Postgres Advisory Locks with Asyncio
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connected-roomba-wrapping-up" class="md-nav__link">
    <span class="md-ellipsis">
      Connected Roomba - Wrapping Up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#connected-roomba-sms" class="md-nav__link">
    <span class="md-ellipsis">
      Connected Roomba - SMS
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="2019">2019<a class="headerlink" href="#2019" title="Permanent link">&para;</a></h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-12-01 00:00:00+00:00">December 1, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              2 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="cleaning-airflow-logs"><a class="toclink" href="../../2019/12/01/cleaning-airflow-logs/">Cleaning Airflow Logs</a></h2>
<p>At home and work I make use of Airflow to automate various batch/time based task. I’ve even setup a container based
Airflow <a href="https://github.com/n0mn0m/airflow-docker">environment</a> to make it easy to bring this up and down.</p>
<p>One of the things you quickly find with Airflow is that while it doesn’t need a lot of resources to run, it can quickly
eat up whatever disk space you provide it with logs. When this happens the first knobs to look at turning are your log
level and your schedulers dag bag refresh rate. While you may not be refreshing dags often your may want to keep your
log level low to capture more data and use your log store to put a TTL on things at the INFO level. Unfortunately you
can't completely turn off Airflows disk logging without building in some custom functionality today. To help manage this
I wrote a small Python script that handles cleaning up the local logs on a given interval. Note if you're running
Airflow in a setup other than LocalExecutor you will want to handle this with something like Cron instead of a dag since
you need to clean logs up on the Scheduler, Worker and Webserver.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">truncateprocessmanagerlog</span><span class="p">(</span><span class="n">logbasepath</span><span class="p">):</span>  
<span class="w"> </span><span class="sd">&quot;&quot;&quot;  </span>
<span class="sd"> The scheduler records all acitivty related to dag processing in the same file.  </span>
<span class="sd"> This file can grow large fast, and is actively in use. Intead of unlinking the  </span>
<span class="sd"> file and pulling it out from under the scheduler truncate.  </span>
<span class="sd"> &quot;&quot;&quot;</span>  
 <span class="n">dagprocessmanagerlog</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>  
 <span class="n">logbasepath</span><span class="p">,</span> <span class="s2">&quot;dagprocessormanager&quot;</span><span class="p">,</span> <span class="s2">&quot;dagprocessormanager.log&quot;</span>  
 <span class="p">)</span>  
 <span class="nb">open</span><span class="p">(</span><span class="n">dagprocessmanagerlog</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  

<span class="k">def</span><span class="w"> </span><span class="nf">traverseandunlink</span><span class="p">(</span><span class="n">fobject</span><span class="p">):</span>  
<span class="w"> </span><span class="sd">&quot;&quot;&quot;  </span>
<span class="sd"> Traverse the log directory on the given airflow instance (webserver, scheduler,  </span>
<span class="sd"> worker, etc) and remove any logs not modified in the last hour.  </span>
<span class="sd"> &quot;&quot;&quot;</span>  
 <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span><span class="n">fobject</span><span class="p">):</span>  
  <span class="n">newfobject</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fobject</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>  
  <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">newfobject</span><span class="p">):</span>  
   <span class="n">lastmodified</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">newfobject</span><span class="p">)</span><span class="o">.</span><span class="n">stmtime</span>  
   <span class="n">delta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span> <span class="o">-</span> <span class="n">lastmodified</span>  
  <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="n">HOURSINMILLISECONDS</span><span class="p">:</span>  
   <span class="nb">print</span><span class="p">(</span>  
    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">newfobject</span><span class="si">}</span><span class="s2"> has not been used in the last hour. \  </span>
   \<span class="n">nCleaning</span> <span class="n">up</span><span class="o">.</span><span class="s2">&quot;  </span>
   <span class="p">)</span>  
   <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">newfobject</span><span class="p">)</span>  
  <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">newfobject</span><span class="p">):</span>  
   <span class="n">traverseandunlink</span><span class="p">(</span><span class="n">newfobject</span><span class="p">)</span>
</code></pre></div>
<p>The full script is available <a href="https://github.com/n0mn0m/snippets/tree/main/airflow-log-cleanup.py">here</a>.</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-12-01 00:00:00+00:00">December 1, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              4 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="review-edx-ut601-embedded-systems"><a class="toclink" href="../../2019/12/01/review-edx-ut601-embedded-systems/">Review EdX UT601 Embedded Systems</a></h2>
<p>I recently completed my first EdX
course <a href="https://courses.edx.org/courses/course-v1:UTAustinX+UT.6.10x+3T2019/course/">Embedded Systems Shape the World</a>
and wanted to share a little bit about the experience.</p>
<p>For a while now I’ve been exploring various venues for continuing education. The longer I’m in my field the more I learn
and then that leads to me realizing how much more I want to learn in new areas. That said I’ve never been great at
taking courses that are not self paced partially because week to week my schedule can change dramatically between work
and family. Because of this over time I’ve tried out multiple platforms of learning such as Pluralsight, Khan Academy,
formal online masters programs etc. All of them have their pros and cons ranging of cost to quality to engaging content.</p>
<p>Last year I started learning more about SoC type hardware via Circuit Playground. This has lead me on an adventure to
learn more and more about embedded systems, C and hardware. Most of this has been stitched together from various sources
and ad hoc as the need arose in a personal project. Towards the end of summer I decided I wanted to formalize this
learning and started to look around. There are online programs from universities like TESU, and individuals offering
classes, but I stumbled across the UT 601 class on EdX and realized the setup would be a good fit for me. Additionally
EdX offers verified courses with certificates which I thought might be nice in the future.</p>
<p>Signing up and getting verified with EdX was easy. I was able to use my laptop and phone to complete all the task in
under 30 minutes. The layout of EdX is very similar to other online learning platforms that I’ve used.</p>
<h4 id="ut-601"><a class="toclink" href="../../2019/12/01/review-edx-ut601-embedded-systems/#ut-601">UT 601</a></h4>
<p>Once I started UT 601 I started to run into a few more barriers. The course requires the purchase of a Texas Instruments
kit for use throughout, which makes sense this is an embedded systems course. What I wasn’t expecting was the use of
Keil. To complete the course I needed to be able to install Keil 4.2, and a simulator DLL (which was pretty neat) on a
Windows platform. A couple annoyances there. This is an online course with the goal of global education opportunities,
but immediately I'm locked into a platform, and additionally Arm places Keil behind a personal information collection
form. I was happy that Microsoft provides a Windows 10 ISO that I could use within a VM to work on the course. After
downloading that though I found that VirtualBox didn't pass through the board USB connection so that I could make use of
the Stellaris Debugging software/firmware that I would need. After some time fiddling with it I ended up switching to
VMWare, and after switching the USB connection to pass through as 2.0 was able to get everything packaged up into a
Windows VM with Keil, the Stellaris software, the simulator DLL and the appropriate Keil registry edits. In case it
would ever help anybody my VMWare config file
is <a href="https://github.com/n0mn0m/snippets/tree/main/Windows%2010%20x64.vmx">here</a>.</p>
<p>After spending a couple days getting the IDE, hardware and VM all setup and playing well together I dove into the
course. Overall I enjoyed it. It exposed me to PIN programming and doing a lot of GPIO work that I haven’t done in the
past. Additionally it was a good refresh on concepts at the beginning like pipelining. One thing I did notice is there
was a big jump from lab 5 to 6. We went from editing template projects to writing most of the project from the ground.
Each section provded a different amount of direction (not gradually declining, but instead seemingly random) on how to
complete the lab. New concepts were quickly introduced and some lacking explination such as using the Keil Oscilliscope
and Analyzer. Overall it was a good course, but I would suggest dedicating a couple weeks and doing it all at once due
to how much it ramps up half way through. The accompanying book is made available in each section and I highly recommend
reading it as the videos act more as highlights than covering the material at a level that prepares you for the labs.</p>
<p>The one thing that was a minor annoyance throughout was the reliance on Keil (IDE’s have a place but often hide what the
compiler and tools are doing creating a gap in knowing how stuff works) and the problems experienced by taking this
course in a VM. Other than that the course was interesting and challenging.</p>
<h4 id="wrapping-up"><a class="toclink" href="../../2019/12/01/review-edx-ut601-embedded-systems/#wrapping-up">Wrapping up</a></h4>
<p>Overall I’m glad I took and <a href="https://burningdaylight.io/static/certifications/Embedded_601.pdf">completed</a> UT601. I
learned a fair amount, and look forward to
taking <a href="https://courses.edx.org/courses/course-v1:UTAustinX+UT.6.20x+3T2019/course/">part 2</a> after the the new year. EdX
is a platform I see myself continuing to use as it’s been super simple, has a range of interesting content, and the
course facilitators are really responsive.</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-10-18 00:00:00+00:00">October 18, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              1 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="edgerouter-x-ddns-with-gandi"><a class="toclink" href="../../2019/10/18/edgerouter-x-ddns-with-gandi/">EdgeRouter X DDNS with Gandi</a></h2>
<p>I recently <a href="https://burningdaylight.io/posts/edgerouter-x-vpn-setup-prt-one/">setup</a> a VPN for my home network. To make
use of it from remote networks I need to be able to resolve the public IP of my router. Instead of hard coding the IP I
setup an domain with Gandi and created an A Record that I update from my router.</p>
<h4 id="fetching-and-reporting-your-ip"><a class="toclink" href="../../2019/10/18/edgerouter-x-ddns-with-gandi/#fetching-and-reporting-your-ip">Fetching and reporting your IP</a></h4>
<p>This part was fairly easy. With a quick search I found that somebody else had already solved the problem of reporting
the public IP from an Ubiquiti router to Gandi! Checkout their
work <a href="https://github.com/georgr/erx-gandi-nat-ddns">here</a>. Their README provides a nice easy walk through of the setup.</p>
<h4 id="scheduling-it"><a class="toclink" href="../../2019/10/18/edgerouter-x-ddns-with-gandi/#scheduling-it">Scheduling it</a></h4>
<p>With the above script updated and working on my router the next thing to do was schedule it.</p>
<blockquote>
<p><em>Quick note only specific directories persist between firmware updates on the EdgeRouter. Because of this I suggest
putting the script above in </em><em>config/scripts/</em><em> or </em><em>config/user-data</em><em>.</em>The EdgeRouter OS provides a helper utility
called task-scheduler which wraps cron. The benefit of task-schedule is that is saves our commands to config so they
persist through upgrades. ssh into your router:</p>
</blockquote>
<div class="highlight"><pre><span></span><code>ssh<span class="w"> </span>&lt;user&gt;@&lt;router&gt;<span class="w">  </span>
configure<span class="w">  </span>
<span class="nb">set</span><span class="w"> </span>system<span class="w"> </span>task-scheduler<span class="w"> </span>task<span class="w"> </span>ddnsupdate<span class="w">  </span>
<span class="nb">set</span><span class="w"> </span>system<span class="w"> </span>task-scheduler<span class="w"> </span>task<span class="w"> </span>ddnsupdate<span class="w"> </span>crontab-spec<span class="w"> </span><span class="s1">&#39;0 5 * * 0&#39;</span><span class="w">  </span>
<span class="nb">set</span><span class="w"> </span>system<span class="w"> </span>task-scheduler<span class="w"> </span>task<span class="w"> </span>ddnsupdate<span class="w"> </span>executable<span class="w"> </span>path<span class="w"> </span><span class="s1">&#39;/config/user-data/&#39;</span><span class="w">  </span>
commit<span class="w">  </span>
save<span class="w">  </span>
cat<span class="w"> </span>/etc/cron.d/vyatta-crontab
</code></pre></div>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-10-18 00:00:00+00:00">October 18, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="edgerouter-x-home-vpn-setup-pt-1"><a class="toclink" href="../../2019/10/18/edgerouter-x-home-vpn-setup-pt-1/">EdgeRouter X Home VPN Setup Pt 1</a></h2>
<p>Recently I got the itch to setup a VPN for my home network to access my device lab on the go, or share with others. My
home setup isn’t too complicated, but it’s a bit different from other setups I found when I started down this path.</p>
<p><strong>Network Components: Arris Surfboard SB6141, Ubiquiti EdgeRouter X, Ubiquiti AmplifiHD</strong></p>
<p><strong>I am not a network or sysadmin by day. This is something I’m actively learning on and figuring out. If you see
something wrong or have suggestions I would love to hear about it. </strong><a href="mailto:n0mn0m@burningdaylight.io"><strong>Reach out.</strong></a></p>
<h4 id="preparing-the-network"><a class="toclink" href="../../2019/10/18/edgerouter-x-home-vpn-setup-pt-1/#preparing-the-network">Preparing the network</a></h4>
<p>As my starting point I had used the EdgeRouter wizard for initial setup way back when. The default places the network in
the 192.168.1.0/24 range which should be changed to prevent a conflict for devices on remote networks. To add a new dhcp
server handing out address in a new range we will use the ubiquiti ui.</p>
<p>To start login to the ubiquiti ui and navigate to the Services tab.</p>
<p><img alt="" src="../../../img/blog/0jrgqlMGhncAE9gc3.png" /></p>
<p>From here you can see + Add DHCP Server on the left side of the screen.</p>
<p><img alt="" src="../../../img/blog/0ZZcInjSyTUYBaR9N.png" /></p>
<p>Select Add and configure a new DHCP server leasing addresses in a new range ( 192.168.<x>.0).</p>
<p><img alt="" src="../../../img/blog/0y2M6lWwPQp5HixGe.png" /></p>
<p>With this setup the next thing to do is test it works before removing the old DHCP server settings.</p>
<p>Return to your Dashboard, and locate the switch0 interface. To the far right you should see an actions button.</p>
<p><img alt="" src="../../../img/blog/08rl1fzwIDLKRFWfl.png" /></p>
<p>Click, select config, and add a manually configured IP for the dhcp server you just configured (192.168.x.1). With
switch0 talking to our new network range return to the Services tab. Click actions on the original DHCP server, select
disable, and then logout.</p>
<p>Now you can log back in on the new network range 192.168.x.1. Login, select switch0 from the Dashboardtab as we did
earlier, and remove the original DHCP server. For any devices on your network that were active you will need to do a
dhclient -r; dhclient to refresh your device (on *nix) ip and lease in the new range.</p>
<h4 id="next-steps"><a class="toclink" href="../../2019/10/18/edgerouter-x-home-vpn-setup-pt-1/#next-steps">Next Steps</a></h4>
<p>With the network configured we are now ready to install and setup wireguard Since this has already ran a bit long in the
tooth part 2 can be found <a href="https://burningdaylight.io/posts/edgerouter-x-vpn-setup-prt-two/">here</a>.</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-10-18 00:00:00+00:00">October 18, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="edgerouter-x-home-vpn-setup-pt-2"><a class="toclink" href="../../2019/10/18/edgerouter-x-home-vpn-setup-pt-2/">EdgeRouter X Home VPN Setup Pt 2</a></h2>
<p><strong>I am not a network or sysadmin by day. This is something I’m actively learning on and figuring out. If you see
something wrong or have suggestions I would love to </strong><a href="mailto:n0mn0m@burningdaylight.io"><strong>hear about it</strong></a><strong>.</strong></p>
<p>In <a href="https://burningdaylight.io/posts/edgerouter-x-vpn-setup-prt-one/">part one</a> we configured the network. Now we are
ready to install Wireguard and create our interface. Before I jumped into doing this I referenced these post and docs.</p>
<ul>
<li><a href="https://www.wireguard.com/quickstart/">Wireguard</a></li>
<li><a href="https://www.erianna.com/wireguard-ubiquity-edgeos/">Charles R. Portwood || Wireguard on Ubiquity OS</a></li>
<li><a href="https://www.erianna.com/wireguard-ubiquity-edgeos/">David Wireguard Home Network</a></li>
</ul>
<p>To get started ssh into the EdgeRouter device.</p>
<div class="highlight"><pre><span></span><code>ssh<span class="w"> </span>&lt;user&gt;@&lt;edgerouterip&gt;Once<span class="w"> </span>logged<span class="w"> </span><span class="k">in</span><span class="w"> </span>we<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span>pull,<span class="w"> </span>install<span class="w"> </span>the<span class="w"> </span>Wireguard<span class="w"> </span>.deb.

<span class="nb">cd</span><span class="w"> </span>/tmp*#<span class="w"> </span>Download<span class="w"> </span>the<span class="w"> </span>appropriate<span class="w"> </span>version,<span class="w"> </span>pay<span class="w"> </span>special<span class="w"> </span>attention<span class="w"> </span>here,<span class="w"> </span><span class="k">if</span><span class="w"> </span>you<span class="w"> </span>are<span class="w"> </span>using<span class="w"> </span>the<span class="w"> </span>Ubiquity<span class="w"> </span>v2<span class="w"> </span>firmware<span class="w">  </span>
<span class="c1"># you will need the wireguard-v2-*  </span>
*curl<span class="w"> </span>-qLs<span class="w"> </span>https://github.com/Lochnair/vyatta-wireguard/releases/download/0.0.20190913-1/wireguard-v2.0-e50-0.0.20190913-1.debsudo<span class="w"> </span>dpkg<span class="w"> </span>-i<span class="w"> </span>wireguard.debAn<span class="w"> </span>important<span class="w"> </span>note<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span><span class="nb">source</span><span class="w"> </span>repo
</code></pre></div>
<p><strong>Note that since Wireguard is not software bundled with the EdgeOS firmware, firmware upgrades necessitate
re-installing the Wireguard debian package. Once the wireguard package is re-installed re-applying the existing Vyatta
config file, or rebooting will restore your interfaces.</strong></p>
<p>First things first we need to generate a private key for the router, and a public key to share with clients.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>wg<span class="w"> </span>genkey<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>/dev/tty<span class="w"> </span><span class="p">|</span><span class="w"> </span>wg<span class="w"> </span>pubkey<span class="w">  </span>
123ddgqeqe123123
</code></pre></div>
<p>This will output two lines. The first is your private key, the second is your public key. Keep these secure, but ready
since you will need to provide the public key to all clients.</p>
<p>With our keys generated we can now configure the Wireguard interface. Ours will be wg0. In the terminal:</p>
<div class="highlight"><pre><span></span><code>configureset<span class="w"> </span>interfaces<span class="w"> </span>wireguard<span class="w"> </span>wg0<span class="w"> </span>address<span class="w"> </span><span class="m">192</span>.168.55.1/24<span class="w">  </span>
<span class="nb">set</span><span class="w"> </span>interfaces<span class="w"> </span>wireguard<span class="w"> </span>wg0<span class="w"> </span>listen-port<span class="w"> </span><span class="m">51820</span><span class="w">  </span>
<span class="nb">set</span><span class="w"> </span>interfaces<span class="w"> </span>wireguard<span class="w"> </span>wg0<span class="w"> </span>route-allowed-ips<span class="w"> </span><span class="nb">true</span><span class="w">  </span>
<span class="nb">set</span><span class="w"> </span>interfaces<span class="w"> </span>wireguard<span class="w"> </span>wg0<span class="w"> </span>private-key<span class="w"> </span>&lt;private-key-from<span class="w"> </span>above-output&gt;commit<span class="w">  </span>
saveThis<span class="w"> </span>created<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>wireguard<span class="w"> </span>network<span class="w"> </span>on<span class="w"> </span><span class="m">192</span>.168.55.1/24<span class="p">;</span><span class="w"> </span>listening<span class="w"> </span>to<span class="w"> </span>port<span class="w"> </span><span class="m">51820</span><span class="w"> </span>and<span class="w"> </span>will<span class="w"> </span>route<span class="w"> </span>all<span class="w"> </span>the<span class="w"> </span>traffic<span class="w"> </span>through<span class="w"> </span>wg0.
</code></pre></div>
<p>Now keeping our public key ready we can configure a client.</p>
<h4 id="configuring-wireguard-on-ubuntu"><a class="toclink" href="../../2019/10/18/edgerouter-x-home-vpn-setup-pt-2/#configuring-wireguard-on-ubuntu">Configuring Wireguard on Ubuntu</a></h4>
<p>If you’re using Ubuntu 19.10 wireguard should be available from apt by default:</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-get<span class="w"> </span>update<span class="w">  </span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>wireguardWith<span class="w"> </span>prior<span class="w"> </span>versions:

sudo<span class="w"> </span>add-apt-repository<span class="w"> </span>ppa:wireguard/wireguard<span class="w">  </span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>update<span class="w">  </span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>wireguardOnce<span class="w"> </span>again<span class="w"> </span>we<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span>generate<span class="w"> </span>our<span class="w"> </span>keys,<span class="w"> </span>now<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>client:

wg<span class="w"> </span>genkey<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>/dev/tty<span class="w"> </span><span class="p">|</span><span class="w"> </span>wg<span class="w"> </span>pubkeyNow,<span class="w"> </span>create<span class="w"> </span>the<span class="w"> </span>wireguard<span class="w"> </span>interface,<span class="w"> </span>still<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>client.

touch<span class="w"> </span>/etc/wireguard/wg0.conf<span class="w">  </span>
chown<span class="w"> </span>root:root<span class="w"> </span>/etc/wireguard/wg0.conf<span class="w">  </span>
chmod<span class="w"> </span><span class="m">600</span><span class="w"> </span>/etc/wireguard/wg0.confsudo<span class="w"> </span>vim<span class="w"> </span>/etc/wireguard/wg0.conf&lt;--------wg0.conf--------&gt;<span class="w">  </span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">[Interface]</span><span class="w">  </span>
<span class="na">Address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">192.168.55.5/32</span><span class="w">  </span>
<span class="na">PrivateKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;client-private-key&gt;[Peer]</span><span class="w">  </span>
<span class="na">PublicKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&lt;router-public-key&gt;</span><span class="w">  </span>
<span class="na">AllowedIPs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">192.168.55.0/24</span><span class="w">  </span>
<span class="na">Endpoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">publicipofrouter:51820</span>
</code></pre></div>
<h4 id="peering-the-router-and-client"><a class="toclink" href="../../2019/10/18/edgerouter-x-home-vpn-setup-pt-2/#peering-the-router-and-client">Peering the router and client</a></h4>
<p>With the client configured and keeping the public key it generated, return to the router. ssh and run:</p>
<p>set interfaces wireguard wg0 peer <client-public-key> allowed-ips 192.168.55.5/32 commit save</p>
<h4 id="starting-your-client-vpn"><a class="toclink" href="../../2019/10/18/edgerouter-x-home-vpn-setup-pt-2/#starting-your-client-vpn">Starting your client VPN</a></h4>
<p>With wg0 configured and ready bring up the VPN on our client.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>wg-quick<span class="w"> </span>up<span class="w"> </span>wg0
</code></pre></div>
<p>And verify connectivity by running sudo wg on the client, and router.</p>
<h4 id="next-steps"><a class="toclink" href="../../2019/10/18/edgerouter-x-home-vpn-setup-pt-2/#next-steps">Next Steps</a></h4>
<p>With VPN setup I’m now able to access and provide access to my device lab. This also keeps devices using this router
that are not part of the lab separated.</p>
<p>Finally if you’re doing this for the first time some next steps you might want to take include:</p>
<ul>
<li>Switch devices to only allowing ssh via keys.</li>
<li>Switch to a non default ssh port.</li>
<li>Setup fail2ban.</li>
<li>Pickup from <a href="https://opensource.com/article/19/10/linux-server-security">here</a></li>
</ul>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-10-18 00:00:00+00:00">October 18, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              2 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="edgerouter-x-pihole-setup"><a class="toclink" href="../../2019/10/18/edgerouter-x-pihole-setup/">EdgeRouter X PiHole Setup</a></h2>
<p>I’ve seen a few post from people asking for help adding a PiHole to their network with an EdgeRouter. One solution I’ve
seen is to use <a href="https://github.com/britannic/blacklist">brittanics black-list</a>. This is nice for those wanting to run
software on their router, but I didn’t want the load, and I want the functionality that the PiHole provides. Hopefully
this guide help those looking to add a PiHole in the future.</p>
<h4 id="setting-up-the-pihole"><a class="toclink" href="../../2019/10/18/edgerouter-x-pihole-setup/#setting-up-the-pihole">Setting up the PiHole</a></h4>
<p>I’m going to assume you’ve already installed PiHole on your device. If not
the <a href="https://github.com/pi-hole/pi-hole">docs</a> are a great place to start. If you set this up on a Raspberry Pi I
encourage you to disable autologin, add a new user, add the user to the sudo group and enable ssh. For more information
checkout the RaspberryPi <a href="https://www.raspberrypi.org/documentation/remote-access/ssh/">docs</a>.</p>
<h4 id="configuring-edgerouter-to-use-the-pihole"><a class="toclink" href="../../2019/10/18/edgerouter-x-pihole-setup/#configuring-edgerouter-to-use-the-pihole">Configuring EdgeRouter to use the PiHole</a></h4>
<p><strong>I’m assuming your edgerouter is the DHCP server on your network.</strong></p>
<p>With PiHole installed, connect the device to your network (preferably wired) and login to the Ubiquity web ui. Click on
the Services tab.</p>
<p><img alt="" src="../../../img/blog/0oJpLVsMSHYQc8A9M.png" /></p>
<p>On this tab you should see an action button on the right side of the screen across from your DHCP information. Click it,
and select configure. In the pop up window select Leases, and you should see the device your PiHole is on. Click the
Static MAC/IP Mapping tab and give this device a static IP.</p>
<p>While we are here click the details tab and add the IP as DNS 1.</p>
<p><img alt="" src="../../../img/blog/0eVNmSkynpiX4nUYh.png" /></p>
<p>Return to the main web ui Dashboard. At the bottom of the screen you should see a system tab with an arrow on the far
right.</p>
<p><img alt="" src="../../../img/blog/0rwz9tJdMQwzQPbei.png" /></p>
<p>Click it and on the right side of the pop up add the IP you just assigned the PiHole as your Name Server.</p>
<p><img alt="" src="../../../img/blog/0A7OE7Ka5iL7knB_D.png" /></p>
<p>With this in place login to your PiHole, navigate to network and you should see your router listed. The device should be
highlighted green with a query count indicating that traffic is flowing through the PiHole as expected.</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-09-27 00:00:00+00:00">September 27, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              2 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="hackaday-connected-world-follow-up"><a class="toclink" href="../../2019/09/27/hackaday-connected-world-follow-up/">Hackaday Connected World Follow Up</a></h2>
<p>Recently Hackaday announced the results of
the <a href="https://hackaday.io/contest/163251-connected-world-contest">Connected World</a> contest. It made my day when I read
Sophi’s email telling me that <a href="https://hackaday.io/project/167025-connected-roomba">ConnectedRoomba</a> was one of the
OSHPark certificate recipients. What may have seemed like a small announcement meant a lot to me. I’m still fairly new
to this area of computing, and without formal training. Instead I spend a lot of time reading, listening and building to
learn everything I can. Validation and success no matter how big or small help us all stay motivated to continue in our
pursuits. Thank you to everybody at Hackaday for setting up a community and contest for us all to continue learning,
sharing and hacking together.</p>
<h4 id="whats-next"><a class="toclink" href="../../2019/09/27/hackaday-connected-world-follow-up/#whats-next">Whats next</a></h4>
<p>Everybody starts somewhere and the contest pushed me to get started on my first homebrew project. As part of this I
found a lot of new areas to study up on. I’ve enrolled in
the <a href="https://courses.edx.org/courses/course-v1:UTAustinX+UT.6.10x+3T2019/course/">edX Embedded Systems</a> course. If
you’re taking that too reach out as I’d love to have a group to work with. Additionally I want to migrate the ngrok
setup in my project to a route on my own domain, understand secure LoRa transmission and expand my electronics
knowledge.</p>
<p>On the board front I found <a href="https://oshpark.com/shared_projects/XuZmZmfd">this</a> interesting Feather PCB
from <a href="https://github.com/tannewt">@tannewt</a> while debating what to do with the OSHPark certificate. I recently backed
the <a href="https://www.crowdsupply.com/sutajio-kosagi/fomu">FOMU</a> and learned of <a href="https://fupy.github.io/">FuPy</a> so this seems
like an interesting PCB to pick up, order some components and start learning electronics at a whole new level.</p>
<p>Congrats to everybody that participated in the Connected World contest. Have fun hacking on whatever comes next! Thank
you Hackaday, DigiKey and OSHPark for kick starting this new learning path :).</p>
<h4 id="contact"><a class="toclink" href="../../2019/09/27/hackaday-connected-world-follow-up/#contact">Contact</a></h4>
<p>If you want to chat feel free to follow up via <a href="mailto:n0mn0m@burningdaylight.io">email</a> or
on <a href="https://github.com/n0mn0m/gencon-portal">Sourcehut</a>.</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-08 00:00:00+00:00">August 8, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="postgres-advisory-locks-with-asyncio"><a class="toclink" href="../../2019/08/08/postgres-advisory-locks-with-asyncio/">Postgres Advisory Locks with Asyncio</a></h2>
<p>Recently, here on the Cloud team at Elastic we started working on building a new service in Python 3.7. This service
fetches data from a Postgres database, transforms it, and then submits that data to another service. Like many
cloud-based services, ours runs in an orchestrated container environment where N instances can be running at any time.
Often that’s a good thing, but our service has a few critical sections where only one instance should be able to process
data. Since we are retrieving data from Postgres, we decided to go ahead and make use of advisory locks to control these
critical sections. In this article I want to explain what advisory locks are, provide an implementation, and test to
verify functionality.</p>
<h4 id="advisory-locks"><a class="toclink" href="../../2019/08/08/postgres-advisory-locks-with-asyncio/#advisory-locks">Advisory locks</a></h4>
<p>Postgres provides the ability to create locks that only have meaning within the context of your application. These
are <a href="https://www.postgresql.org/docs/9.4/explicit-locking.html#ADVISORY-LOCKS">advisory locks</a>. You use advisory locks
to control an application’s ability to process data. Anytime your application is about to enter a critical path, you
attempt to acquire the lock. When you acquire the lock, you can safely continue processing.</p>
<p>async with AdvisoryLock("goldleader", dbconfig) as connection:If it fails, then your application may retry, wait, or
exit. Since this lock is external to the application, this allows for multiple instances of the application to run while
providing safe critical path concurrency.</p>
<h4 id="building-the-lock"><a class="toclink" href="../../2019/08/08/postgres-advisory-locks-with-asyncio/#building-the-lock">Building the lock</a></h4>
<p>As part of our work, we wanted to make using advisory locks easy. To do this, we created the PostgresAdvisoryLock
context manager. Since this is meant to be used with asyncio and asyncpg, we control the acquisition and release of the
lock via aenter and aexit.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AdvisoryLock</span><span class="p">:</span>  
 <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">aenter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">asyncpg</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">Connection</span><span class="p">:</span>  
 <span class="bp">self</span><span class="o">.</span><span class="n">lockedconnection</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncpg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>  
 <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">setlock</span><span class="p">()</span>  
 <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gotlock</span><span class="p">:</span>  
 <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lockedconnection</span>  
 <span class="k">else</span><span class="p">:</span>  
 <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lockedconnection</span><span class="p">:</span>  
 <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">lockedconnection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  
 <span class="k">raise</span> <span class="n">AdvisoryLockException</span> <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">aexit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exctype</span><span class="p">,</span> <span class="n">excval</span><span class="p">,</span> <span class="n">exctb</span><span class="p">):</span>  
 <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">release</span><span class="p">()</span><span class="n">Now</span> <span class="n">this</span> <span class="n">can</span> <span class="n">be</span> <span class="n">called</span> <span class="n">like</span> <span class="nb">any</span> <span class="n">other</span> <span class="k">async</span> <span class="n">context</span> <span class="n">manager</span><span class="o">.</span>

<span class="k">async</span> <span class="k">with</span> <span class="n">AdvisoryLock</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="s2">&quot;appname&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>  
 <span class="n">val</span> <span class="o">=</span> <span class="k">await</span> <span class="n">connection</span><span class="o">.</span><span class="n">fetchrow</span><span class="p">(</span><span class="s2">&quot;SELECT 1&quot;</span><span class="p">)</span>
</code></pre></div>
<h4 id="testing-the-lock"><a class="toclink" href="../../2019/08/08/postgres-advisory-locks-with-asyncio/#testing-the-lock">Testing the lock</a></h4>
<p>Now that the PostgresAdvisoryLock class is implemented, we need to test it. To start we verify the base functionality by
acquiring the lock, running a query, and validating we can't get the lock inside the same scope. I recommend using the
asynctest library to help work with asyncio inside unittest.</p>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">testgetresultswithlock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
 <span class="k">async</span> <span class="k">with</span> <span class="n">AdvisoryLock</span><span class="p">(</span><span class="s2">&quot;goldleader&quot;</span><span class="p">,</span> <span class="n">dbconfig</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>  
 <span class="n">val</span> <span class="o">=</span> <span class="k">await</span> <span class="n">connection</span><span class="o">.</span><span class="n">fetchrow</span><span class="p">(</span><span class="s2">&quot;SELECT 1;&quot;</span><span class="p">)</span>  
 <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span> <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">testlockpreventssecondlock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
 <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">AdvisoryLockException</span><span class="p">):</span>  
 <span class="k">async</span> <span class="k">with</span> <span class="n">AdvisoryLock</span><span class="p">(</span><span class="s2">&quot;goldleader&quot;</span><span class="p">,</span> <span class="n">dbconfig</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>  
 <span class="k">await</span> <span class="n">connection</span><span class="o">.</span><span class="n">fetchrow</span><span class="p">(</span><span class="s2">&quot;SELECT 1;&quot;</span><span class="p">)</span>  
 <span class="k">async</span> <span class="k">with</span> <span class="n">AdvisoryLock</span><span class="p">(</span><span class="s2">&quot;goldleader&quot;</span><span class="p">,</span> <span class="n">dbconfig</span><span class="p">)</span> <span class="k">as</span> <span class="n">secondconnection</span><span class="p">:</span>  
 <span class="k">await</span> <span class="n">secondconnection</span><span class="o">.</span><span class="n">fetchrow</span><span class="p">(</span><span class="s2">&quot;SELECT 1;&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Since we are going to use this to control the execution of code across many processes, we also need to verify external
process behavior. To do this we use the asyncio subprocess.createsubprocessexec function to create a new process. This
process attempts to get the lock our main process already has, and it should fail.</p>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">testadvisorylockpreventsaccessfromseparateprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
 <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">AdvisoryLockException</span><span class="p">):</span>  
 <span class="k">async</span> <span class="k">with</span> <span class="n">AdvisoryLock</span><span class="p">(</span><span class="s2">&quot;goldleader&quot;</span><span class="p">,</span> <span class="n">dbconfig</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>  
 <span class="n">proc</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">createsubprocessexec</span><span class="p">(</span>  
 <span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span>  
 <span class="s2">&quot;-c&quot;</span><span class="p">,</span>  
 <span class="n">executable</span><span class="p">,</span>  
 <span class="n">stderr</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>  
 <span class="p">)</span>
</code></pre></div>
<h4 id="wrapping-up"><a class="toclink" href="../../2019/08/08/postgres-advisory-locks-with-asyncio/#wrapping-up">Wrapping up</a></h4>
<p>When we started to build our new application, we knew we would be waiting on the network and database. Since we also had
work that could happen during the wait, we decided to use asyncio. Additionally we identified a critical path where we
used Postgres to achieve concurrency control. To make critical path control easier we created a module and a series of
tests. Once finished we realized this might be helpful to others looking for the same control, or as a reference for
those learning to test with asyncio.</p>
<p>You can find the full implementation and Docker setup <a href="https://github.com/n0mn0m/PostgresAdvisoryLock">on Sourcehut</a>.</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-04 00:00:00+00:00">August 4, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="connected-roomba-wrapping-up"><a class="toclink" href="../../2019/08/04/connected-roomba---wrapping-up/">Connected Roomba - Wrapping Up</a></h2>
<p>With everything working I wanted to make sure I didn’t have to reset everything anytime an odd decode error occurs,
something loses and regains power, etc. For the Feather attached to the Roomba handling this is pretty straight forward.
Everything is already running in a super loop, so all I need to add is a try/exceptblock to the while loop and discard
errors. Doing the same thing for the Pi was again straight forward, but since it is running Linux I needed to make sure
the applications handled failures, and that the scripts restart if the board restarts, the OS bounces, etc.</p>
<p>Similar to the Feather code I wrapped everything in a while loop, added exception handlers, but I also added logging so
that I could understand if errors are created by the OS, the code or something else:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>  

<span class="n">LOGFORMAT</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2">:</span><span class="si">%(levelname)s</span><span class="s2">:</span><span class="si">%(message)s</span><span class="s2">&quot;</span>  

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>  
 <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;/home/pi/logs/button.log&quot;</span><span class="p">,</span>  
 <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>  
 <span class="nb">format</span><span class="o">=</span><span class="n">LOGFORMAT</span><span class="p">,</span>  
 <span class="n">datefmt</span><span class="o">=</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y %I:%M:%S %p&quot;</span><span class="p">,</span>  
<span class="p">)</span>  

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">...</span><span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;main&quot;</span><span class="p">:</span>  
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>  
 <span class="k">try</span><span class="p">:</span>  
 <span class="o">...</span>  
 <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>  
  <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>  
 <span class="k">pass</span>
</code></pre></div>
<p>And since this is running on Linux setting up cron to handle starting the applications after reboot was one command
away.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>crontab<span class="w"> </span>-e@reboot<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/home/pi/<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>/home/pi/.virtualenvs/lora-pi/bin/python<span class="w"> </span>/home/pi/projects/roombasupervisor/buttonlistener.py<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/home/pi/logs/button.log<span class="w">  </span>
@reboot<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/home/pi/<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>/home/pi/.virtualenvs/lora-pi/bin/python<span class="w"> </span>/home/pi/projects/roombasupervisor/smslistener.py<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/home/pi/logs/sms.log<span class="w">  </span>
@reboot<span class="w"> </span>sleep<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/home/pi/<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>/home/pi/ngrok<span class="w"> </span>http<span class="w"> </span><span class="m">5000</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/home/pi/logs/ngrok.log<span class="w">  </span>
@reboot<span class="w"> </span>sleep<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>curl<span class="w"> </span>http://127.0.0.1:4040/api/tunnels<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span>&gt;<span class="w"> </span>/home/pi/logs/ngrokdetails.log
</code></pre></div>
<p><img alt="" src="../../../img/blog/0LW52qqaYhmwjQMbx.gif" /></p>
<h4 id="wrapping-up"><a class="toclink" href="../../2019/08/04/connected-roomba---wrapping-up/#wrapping-up">Wrapping Up</a></h4>
<p>Since this was my first project interacting with an embedded system I learned quite a bit along the way. Abstractions
are something that are useful, but can add bloat and load that won’t work in constrained environments. I wasn’t able to
use the Roomba library I built with the Circuit Playground on the Feather that I connected to the Roomba. CircuitPython
made learning and prototyping easy with a REPL and constant connection to the Open Interface. It also allowed me to
focus on learning more about the boards and data interactions since I wasn’t busy rebuilding my software toolchain for a
new environment. That said it has also inspired me to learn more and dig deeper into the embedded world since there are
a lot of things I can’t user (interupts). There is a lot that I don’t know or understand yet, but with the help of some
books and boards I am sure I will be busy expanding my understanding for the next few years.</p>
<h4 id="contact"><a class="toclink" href="../../2019/08/04/connected-roomba---wrapping-up/#contact">Contact</a></h4>
<p>I really enjoyed working on this project. If you want to reach out feel free to follow up
via <a href="mailto:n0mn0m@burningdaylight.io">email</a> or on .</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-03 00:00:00+00:00">August 3, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              2 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="connected-roomba-sms"><a class="toclink" href="../../2019/08/03/connected-roomba---sms/">Connected Roomba - SMS</a></h2>
<p>As I mentioned before one of the primary reasons for starting this project was to let my wife and I start the Roomba
when we are not at home. One device that most of us take everywhere is our phone. An easy way to to send information
from your phone without a custom app, stack and hassle is SMS. While it’s easy to broadcast receiving that message can
take a little work.</p>
<h4 id="twilio"><a class="toclink" href="../../2019/08/03/connected-roomba---sms/#twilio">Twilio</a></h4>
<p>Luckily monitoring a number for messages is pretty much a solved problem. Twilio offers an easy way to setup number with
an attached webhook for receiving and sending messages. They also have a
nice <a href="https://www.twilio.com/docs/quickstart/python">Python tutorial</a>that had me up and running in about 10 minutes.
Since I was already using the Pi Zero to send commands to the Roomba setting up a script to watch for an SMS message and
pass on the new command was simple enough.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">busio</span>  
<span class="kn">import</span><span class="w"> </span><span class="nn">board</span>  
<span class="kn">import</span><span class="w"> </span><span class="nn">adafruitrfm9x</span>  
<span class="kn">from</span><span class="w"> </span><span class="nn">digitalio</span><span class="w"> </span><span class="kn">import</span> <span class="n">DigitalInOut</span>  
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span>  
<span class="kn">from</span><span class="w"> </span><span class="nn">twilio.twiml.messagingresponse</span><span class="w"> </span><span class="kn">import</span> <span class="n">MessagingResponseCS</span> <span class="o">=</span> <span class="n">DigitalInOut</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">CE1</span><span class="p">)</span>  

<span class="n">RESET</span> <span class="o">=</span> <span class="n">DigitalInOut</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">D25</span><span class="p">)</span>  
<span class="n">spi</span> <span class="o">=</span> <span class="n">busio</span><span class="o">.</span><span class="n">SPI</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">SCK</span><span class="p">,</span> <span class="n">MOSI</span><span class="o">=</span><span class="n">board</span><span class="o">.</span><span class="n">MOSI</span><span class="p">,</span> <span class="n">MISO</span><span class="o">=</span><span class="n">board</span><span class="o">.</span><span class="n">MISO</span><span class="p">)</span>  
<span class="n">rfm9x</span> <span class="o">=</span> <span class="n">adafruitrfm9x</span><span class="o">.</span><span class="n">RFM9x</span><span class="p">(</span><span class="n">spi</span><span class="p">,</span> <span class="n">CS</span><span class="p">,</span> <span class="n">RESET</span><span class="p">,</span> <span class="mf">433.0</span><span class="p">)</span>  
<span class="n">rfm9x</span><span class="o">.</span><span class="n">txpower</span> <span class="o">=</span> <span class="mi">23</span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>  

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s2">&quot;/sms&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">])</span>  
<span class="k">def</span><span class="w"> </span><span class="nf">smsstartroomba</span><span class="p">():</span>  
<span class="w">  </span><span class="sd">&quot;&quot;&quot;  </span>
<span class="sd">  When a message is received determine which  </span>
<span class="sd">  signal to send the Roomba and reply  </span>
<span class="sd">  to the sender.  </span>
<span class="sd">  &quot;&quot;&quot;</span><span class="o">**</span> <span class="o">*</span><span class="n">txt</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Body&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">txt</span> <span class="o">==</span> <span class="s2">&quot;start&quot;</span><span class="p">:</span>  
  <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Starting the Roomba.&quot;</span>  
  <span class="n">cmd</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;ascii&quot;</span><span class="p">)</span>  
  <span class="k">elif</span> <span class="n">txt</span> <span class="o">==</span> <span class="s2">&quot;halt&quot;</span><span class="p">:</span>  
  <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Stopping the Roomba.&quot;</span>  
  <span class="n">cmd</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;ascii&quot;</span><span class="p">)</span>  
  <span class="k">elif</span> <span class="n">txt</span> <span class="o">==</span> <span class="s2">&quot;dock&quot;</span><span class="p">:</span>  
  <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Roomba beginning to dock.&quot;</span>  
  <span class="n">cmd</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;ascii&quot;</span><span class="p">)</span>  
  <span class="k">else</span><span class="p">:</span>  
  <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Unknown command. Continuing.&quot;</span>  
  <span class="n">cmd</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">cmd</span><span class="p">:</span>  
  <span class="n">rfm9x</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">MessagingResponse</span><span class="p">()</span>  
  <span class="n">resp</span><span class="o">.</span><span class="n">message</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>  

<span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;main&quot;</span><span class="p">:</span>  
 <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
<p>And with that the same board I had used to test sending messages in response to button clicks can now receive SMS
payloads and translate that into a command that the Feather will use to start, stop or dock the Roomba.</p>
<h4 id="next-steps"><a class="toclink" href="../../2019/08/03/connected-roomba---sms/#next-steps">Next Steps</a></h4>
<p>With all the pieces assembled and working the last thing to do for version 1 was setup some redundancy, restart
everything and make sure it all worked as expected without my intervention.</p>
    
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  <span class="md-pagination__current">1</span> <a class="md-pagination__link" href="page/2/">2</a>
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="/feed_rss_updated.xml" target="_blank" rel="noopener" title="RSS Feed" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 64c0-17.7 14.3-32 32-32 229.8 0 416 186.2 416 416 0 17.7-14.3 32-32 32s-32-14.3-32-32C384 253.6 226.4 96 32 96 14.3 96 0 81.7 0 64m0 352a64 64 0 1 1 128 0 64 64 0 1 1-128 0m32-256c159.1 0 288 128.9 288 288 0 17.7-14.3 32-32 32s-32-14.3-32-32c0-123.7-100.3-224-224-224-17.7 0-32-14.3-32-32s14.3-32 32-32"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.path", "icons"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
      
    
  </body>
</html>